<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Danielle Navarro">
<meta name="dcterms.date" content="2024-12-16">
<meta name="description" content="Now I have \2 problems">

<title>Baby got backreferences – Notes from a data witch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #eeeeee;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Baby got backreferences – Notes from a data witch">
<meta property="og:description" content="Now I have \2 problems">
<meta property="og:image" content="https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/babygotback1.jpg">
<meta property="og:site_name" content="Notes from a data witch">
<meta property="og:image:alt" content="Four women dancing">
<meta name="twitter:title" content="Baby got backreferences – Notes from a data witch">
<meta name="twitter:description" content="Now I have \2 problems">
<meta name="twitter:image" content="https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/babygotback1.jpg">
<meta name="twitter:creator" content="@djnavarro">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:alt" content="Four women dancing">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml"> 
<span class="menu-text">RSS</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sites" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sites</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-sites">    
        <li>
    <a class="dropdown-item" href="https://djnavarro.net">
 <span class="dropdown-text">Homepage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://blog.djnavarro.net">
 <span class="dropdown-text">Data science blog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://art.djnavarro.net">
 <span class="dropdown-text">Generative art</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://papers.djnavarro.net">
 <span class="dropdown-text">Academic papers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://djnavarro.net/sites">
 <span class="dropdown-text">More…</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Baby got backreferences</h1>
                  <div>
        <div class="description">
          Now I have \2 problems
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Regular Expressions</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://djnavarro.net">Danielle Navarro</a> <a href="https://orcid.org/0000-0001-7648-6578" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 16, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#warning" id="toc-warning" class="nav-link active" data-scroll-target="#warning">Warning</a></li>
  <li><a href="#simple-matches" id="toc-simple-matches" class="nav-link" data-scroll-target="#simple-matches">Simple matches</a></li>
  <li><a href="#quantifiers" id="toc-quantifiers" class="nav-link" data-scroll-target="#quantifiers">Quantifiers</a></li>
  <li><a href="#backslashes-part-i" id="toc-backslashes-part-i" class="nav-link" data-scroll-target="#backslashes-part-i">Backslashes (part I)</a></li>
  <li><a href="#character-sets" id="toc-character-sets" class="nav-link" data-scroll-target="#character-sets">Character sets</a>
  <ul class="collapse">
  <li><a href="#ranges-and-shorthand-notation" id="toc-ranges-and-shorthand-notation" class="nav-link" data-scroll-target="#ranges-and-shorthand-notation">Ranges and shorthand notation</a></li>
  <li><a href="#logical-operations-with-character-sets" id="toc-logical-operations-with-character-sets" class="nav-link" data-scroll-target="#logical-operations-with-character-sets">Logical operations with character sets</a></li>
  </ul></li>
  <li><a href="#anchors-and-boundaries" id="toc-anchors-and-boundaries" class="nav-link" data-scroll-target="#anchors-and-boundaries">Anchors and boundaries</a></li>
  <li><a href="#groups" id="toc-groups" class="nav-link" data-scroll-target="#groups">Groups</a></li>
  <li><a href="#pipes-as-or-operators" id="toc-pipes-as-or-operators" class="nav-link" data-scroll-target="#pipes-as-or-operators">Pipes as “or” operators</a></li>
  <li><a href="#dots-as-any-character" id="toc-dots-as-any-character" class="nav-link" data-scroll-target="#dots-as-any-character">Dots as “any” character</a></li>
  <li><a href="#intermission-very-important-applied-regex" id="toc-intermission-very-important-applied-regex" class="nav-link" data-scroll-target="#intermission-very-important-applied-regex">Intermission: Very important applied regex</a></li>
  <li><a href="#backreferences" id="toc-backreferences" class="nav-link" data-scroll-target="#backreferences">Backreferences</a></li>
  <li><a href="#lookaheadlookbehind" id="toc-lookaheadlookbehind" class="nav-link" data-scroll-target="#lookaheadlookbehind">Lookahead/lookbehind</a></li>
  <li><a href="#three-regex-flavours" id="toc-three-regex-flavours" class="nav-link" data-scroll-target="#three-regex-flavours">Three regex flavours</a></li>
  <li><a href="#backslashes-part-ii" id="toc-backslashes-part-ii" class="nav-link" data-scroll-target="#backslashes-part-ii">Backslashes (part II)</a>
  <ul class="collapse">
  <li><a href="#special-characters-outside-a-character-set" id="toc-special-characters-outside-a-character-set" class="nav-link" data-scroll-target="#special-characters-outside-a-character-set">Special characters outside a character set</a></li>
  <li><a href="#special-characters-inside-a-character-set" id="toc-special-characters-inside-a-character-set" class="nav-link" data-scroll-target="#special-characters-inside-a-character-set">Special characters inside a character set</a></li>
  </ul></li>
  <li><a href="#substitution" id="toc-substitution" class="nav-link" data-scroll-target="#substitution">Substitution</a></li>
  <li><a href="#im-so-sorry-for-my-loss" id="toc-im-so-sorry-for-my-loss" class="nav-link" data-scroll-target="#im-so-sorry-for-my-loss">I’m so sorry for my loss</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<!--------------- my typical setup ----------------->
<div class="cell">
<style type="text/css">
@import url('https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap');

.tangerine-regular {
  font-family: "Tangerine", cursive;
  font-weight: 400;
  font-style: normal;
}

.tangerine-bold {
  font-family: "Tangerine", cursive;
  font-weight: 700;
  font-style: normal;
}
</style>
</div>
<!--------------- post begins here ----------------->
<p>At least once a week I experience a particular kind of despair that is all too familiar to programmers. I am sitting alone with my laptop and my code, minding my own business, working quietly. Out of nothing a yawning pit of black despair opens at my feet, barbed tentacles wrap around my legs, poison injects chill into my veins, the icy claws of anxiety rip through my viscera, and a withered voice of pure evil slithers into my brain. The voice speaks to me in the disturbingly-seductive language of Mordor, and a terrible incantation consumes my thoughts:</p>
<p class="tangerine-bold" align="center" style="font-size: 28pt">
why not write a regular expression?
</p>
<p>I try to resist. I’m a good girl, I tell the Dark Lord. I would never. Not on a first date anyway. Well, buy a girl a drink first maybe? And… oh it’s so cold outside and, I mean, Sauron is kinda hot. Have you not watched Rings of Power? Sometimes a girl has needs.</p>
<p>Um. Anyway. What was I talking about? Oh, right. <a href="https://www.regular-expressions.info/">Regular expressions</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sauron.jpg" class="img-fluid figure-img"></p>
<figcaption>You don’t have the look of someone to whom regular expressions happen by accident</figcaption>
</figure>
</div>
<p><br></p>
<section id="warning" class="level2">
<h2 class="anchored" data-anchor-id="warning">Warning</h2>
<p>Let’s start this love affair with darkness with a disclaimer: I have <em>never</em> wanted to write a primer on working with regular expressions in R. I loathe regular expressions, and I am not good at them. About 99% of my knowledge of regular expressions comes from weeping in abject despair with a dozen R documentation tabs open and desperately clicking on random links at <a href="https://www.regular-expressions.info">www.regular-expressions.info</a> to work out why my regex doesn’t work.</p>
<p>I am, very clearly, not an expert.</p>
<p>So why am I, a grotesquely unqualified woman, writing this post anyway? Honestly, the answer is because <strong>this post is the tutorial that I need</strong>. I’m writing this as an act of solidarity with future Danielle, who will find inevitably herself crying at her keyboard trying to make a basic regex work, and will need a little kindness and support. With that in mind, and knowing exactly who will be revisiting this post in six months time in tears… you got this girl. I believe in you.</p>
<p>Let’s get started. In this post I’ll be working mostly with the stringr package, so I’ll load that at the beginning:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll use a variety of sources for the text, mostly song lyrics. Each of those is stored in a text file so I’ll read the text now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>feather <span class="ot">&lt;-</span> brio<span class="sc">::</span><span class="fu">read_lines</span>(<span class="st">"feather.txt"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>femininomenon <span class="ot">&lt;-</span> brio<span class="sc">::</span><span class="fu">read_lines</span>(<span class="st">"femininomenon.txt"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>midnight <span class="ot">&lt;-</span> brio<span class="sc">::</span><span class="fu">read_lines</span>(<span class="st">"midnight.txt"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>babygotback <span class="ot">&lt;-</span> brio<span class="sc">::</span><span class="fu">read_lines</span>(<span class="st">"babygotback.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these is a vector of strings. To give you a sense of what they look like, here’s the first few lines in the opening to <code>babygotback</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(babygotback)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] "[Intro: Girl]"                                                        
[2] "Oh my God, Becky, look at her butt, it is so big, ugh"                
[3] "She looks like one of those rap guys' girlfriends, but, ugh, you know"
[4] "Who understands those rap guys? Ugh, they only talk to her"           
[5] "Because she looks like a total prostitute, okay?"                     
[6] "I mean, her butt, it's just so big"                                   
</pre>
</div>
<p>We shall return to this classic text later, but the first few examples will all use <code>femininomenon</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(femininomenon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] "[Verse 1]"                                        
[2] "Same old story, time again"                       
[3] "Got so close but then you lost it"                
[4] "Should've listened to your friends"               
[5] "'Bout his girlfriend back in Boston"              
[6] "You sent him pictures and playlists and phone sex"
</pre>
</div>
<p>Hopefully you get the idea. Each of these is a vector, each element is a string, and we’ll do some pattern matching on those strings, most often using <code>str_view()</code> from the stringr package to show which parts of the text each regex matches against. It’s not the best tool for using in a script, but it’s ideal as a way of visually inspecting the results of a regular expression matching exercise.</p>
</section>
<section id="simple-matches" class="level2">
<h2 class="anchored" data-anchor-id="simple-matches">Simple matches</h2>
<p>It begins with the very, very basics. Regular expressions are a tool for matching (and sometimes modifying) patterns in text strings. The simplest way to write a regular expression is to detect strings that match a specific, fixed subset of text. For instance, let’s say I want to find every line in <a href="https://www.youtube.com/watch?v=xdaKBAuO8zg">Femininomenon</a> in which Chappell Roan sings the word <code>"femininomenon"</code>. Using <code>str_view()</code> this is what we get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> femininomenon,   <span class="co"># the song lyrics</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"femininomenon"</span> <span class="co"># the regular expression</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[24] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[28] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[53] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[57] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[65] │ Well, what we really need is a <span style="color:#008080">&lt;femininomenon&gt;</span>
[66] │ (A what?) A <span style="color:#008080">&lt;femininomenon&gt;</span>
[72] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[82] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[86] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[90] │ Make a bitch, it's a fem (It's a <span style="color:#008080">&lt;femininomenon&gt;</span>)
</pre>
</div>
<p>In this output, the teal-highlighted text<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> enclosed in angle brackets displays the sections of the text that match the regular expression. In this case our regular expression is very simple. It’s just a literal string <code>"femininomenon"</code>, so the output highlights every instance of that word.</p>
<p>Notice also that not every line in the song is shown by <code>str_view()</code>. Only those lines that match the regular expression are included (you can see that in the numbers to the left of each match). However, we can change this behaviour using the <code>match</code> argument to <code>str_view()</code>. For example, if wanted to see only those lines that <em>don’t</em> include the letter <code>e</code>, we could do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> femininomenon,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"e"</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">match =</span> <span class="cn">FALSE</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[11] │ Why can't any man
[12] │ 
[19] │ 
[20] │ [Chorus]
[29] │ 
[40] │ Why can't any man
[41] │ 
[48] │ 
[49] │ [Chorus]
[58] │ 
[67] │ 
[77] │ 
[78] │ [Chorus]
[87] │ 
[88] │ [Outro]
</pre>
</div>
<p>Alternatively, we could set <code>match = NA</code>. If we do this, <code>str_view()</code> will return every line in the song, whether it matches or not. Here’s an example. Let’s search for every instance of the word <code>"you"</code>, and set <code>match = NA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> femininomenon,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"you"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">match =</span> <span class="cn">NA</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [1] │ [Verse 1]
 [2] │ Same old story, time again
 [3] │ Got so close but then <span style="color:#008080">&lt;you&gt;</span> lost it
 [4] │ Should've listened to <span style="color:#008080">&lt;you&gt;</span>r friends
 [5] │ 'Bout his girlfriend back in Boston
 [6] │ You sent him pictures and playlists and phone sex
 [7] │ He disappeared from the second that <span style="color:#008080">&lt;you&gt;</span> said
 [8] │ "Let's get coffee, let's meet up"
 [9] │ I'm so sick of online love
[10] │ And I don't understand
[11] │ Why can't any man
[12] │ 
[13] │ [Pre-Chorus]
[14] │ Hit it like, get it hot
[15] │ Make a bitch, it's a fem
[16] │ Hit it like, get it hot
[17] │ Make a bitch, it's a—
[18] │ Um, can <span style="color:#008080">&lt;you&gt;</span> play a song with a fucking beat?
[19] │ 
[20] │ [Chorus]
... and 72 more
</pre>
</div>
<p>This output illustrates two things. First, you can see that there’s a match on lines 3, 4, 7, 18, and probably others too (the remaining 72 lines of the song aren’t shown in the output but they are actually included in the <code>str_view()</code> output). Second, it shows that our regular expression isn’t quite doing the job we want it to: the match on line 4 matches the first three letters of the word “your”, and it doesn’t match to line 6 because that line contains the word “You” with an upper case “Y”. If we want a regular expression to match “you” and “You” but not match against “your”, it needs to be something a little more nuanced than setting <code>pattern = "you"</code> like I did above.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="femininomenon.jpg" class="img-fluid figure-img"></p>
<figcaption>I sent him pictures and playlists and regex</figcaption>
</figure>
</div>
</section>
<section id="quantifiers" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="quantifiers">Quantifiers</h2>
<p>For the moment, let’s set aside the thorny question of how to handle capitalisation, and focus instead on the “you” vs “your” issue. Moreover, let’s move the goalposts, and pretend that our new goal is actually to detect <em>both</em> <code>"you"</code> and <code>"your"</code>. This post is <a href="https://en.wikipedia.org/wiki/Long-term_nuclear_waste_warning_messages">not a place of honour</a>, and I’m not above cheating when it comes to these matters.</p>
<p>We can solve our new problem with the help of <strong>quantifiers</strong>. In regular expression syntax, certain character (sometimes called “metacharacters”) have special meanings. For example, the <code>?</code> character is used to indicate that the preceding character is optional. When we write <code>"your?"</code> as our regular expression, the <code>r?</code> part indicates that the <code>r</code> character is optional. It will match against both <code>"you"</code> and <code>"your"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"your?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [3] │ Got so close but then <span style="color:#008080">&lt;you&gt;</span> lost it
 [4] │ Should've listened to <span style="color:#008080">&lt;your&gt;</span> friends
 [7] │ He disappeared from the second that <span style="color:#008080">&lt;you&gt;</span> said
[18] │ Um, can <span style="color:#008080">&lt;you&gt;</span> play a song with a fucking beat?
[33] │ Lying to <span style="color:#008080">&lt;your&gt;</span> friends about
[35] │ Stuck in the suburbs, <span style="color:#008080">&lt;you&gt;</span>'re folding his laundry
[36] │ Got what <span style="color:#008080">&lt;you&gt;</span> wanted, so stop feeling sorry
[47] │ Dude, can <span style="color:#008080">&lt;you&gt;</span> play a song with a fucking beat?
[60] │ Ladies, <span style="color:#008080">&lt;you&gt;</span> know what I mean
[61] │ And <span style="color:#008080">&lt;you&gt;</span> know what <span style="color:#008080">&lt;you&gt;</span> need
[76] │ Did <span style="color:#008080">&lt;you&gt;</span> hear me? Play the fucking beat
</pre>
</div>
<p>Here you can see that it matches the <code>"you"</code> on line 3 and the <code>"your"</code> on line 4. However, on line 35 where it encounters the word <code>"you're"</code> it detects a match, but <em>only</em> to the <code>"you"</code> part of the word.</p>
<p>There are several quantifiers supported by most regular expression flavours.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Quantifiers always refer to the previous item, and specify the number of repetitions of the previous item that can be matched:</p>
<ul>
<li><code>?</code> matches the previous item zero or one time</li>
<li><code>*</code> matches the previous item zero or more times</li>
<li><code>+</code> matches the previous item one or more times</li>
<li><code>{n}</code> matches the previous item exactly n times</li>
<li><code>{n,}</code> matches the previous item n or more times</li>
<li><code>{n,m}</code> matches the previous item at least n times but not more than m times</li>
</ul>
<p>This behaviour is (of course!) described in numerous places in the R documentation, but I find it helps a lot to have a concrete example that shows the differences between each of these. In the table below, the rows correspond to the strings <code>"a"</code>, <code>"ab"</code>, <code>"abb"</code>, and so on. Each column corresponds to a a regular expression that is always <code>"ab"</code> with a quantifier applied to the letter <code>"b"</code>. In each cell of the table, I’ve used <code>str_view()</code> to show how each string matches (or doesn’t match) against each of the regexes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string    =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"ab"</span>, <span class="st">"abb"</span>, <span class="st">"abbb"</span>, <span class="st">"abbbb"</span>, <span class="st">"abbbbb"</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab?</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab?"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab*</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab*"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab+</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab+"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2}</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2}"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2,}</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2,}"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2,4}</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2,4}"</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<pre># A tibble: 6 × 7
  string `ab?`      `ab*`      `ab+`      `ab{2}`    `ab{2,}`   `ab{2,4}` 
  <span style="color:#008080">&lt;chr&gt;</span>  <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span>
1 a      <span style="color:#008080">&lt;a&gt;</span>        <span style="color:#008080">&lt;a&gt;</span>        a          a          a          a         
2 ab     <span style="color:#008080">&lt;ab&gt;</span>       <span style="color:#008080">&lt;ab&gt;</span>       <span style="color:#008080">&lt;ab&gt;</span>       ab         ab         ab        
3 abb    <span style="color:#008080">&lt;ab&gt;</span>b      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>     
4 abbb   <span style="color:#008080">&lt;ab&gt;</span>bb     <span style="color:#008080">&lt;abbb&gt;</span>     <span style="color:#008080">&lt;abbb&gt;</span>     <span style="color:#008080">&lt;abb&gt;</span>b     <span style="color:#008080">&lt;abbb&gt;</span>     <span style="color:#008080">&lt;abbb&gt;</span>    
5 abbbb  <span style="color:#008080">&lt;ab&gt;</span>bbb    <span style="color:#008080">&lt;abbbb&gt;</span>    <span style="color:#008080">&lt;abbbb&gt;</span>    <span style="color:#008080">&lt;abb&gt;</span>bb    <span style="color:#008080">&lt;abbbb&gt;</span>    <span style="color:#008080">&lt;abbbb&gt;</span>   
6 abbbbb <span style="color:#008080">&lt;ab&gt;</span>bbbb   <span style="color:#008080">&lt;abbbbb&gt;</span>   <span style="color:#008080">&lt;abbbbb&gt;</span>   <span style="color:#008080">&lt;abb&gt;</span>bbb   <span style="color:#008080">&lt;abbbbb&gt;</span>   <span style="color:#008080">&lt;abbbb&gt;</span>b  
</pre>
</div>
<p>Notice that these are all <strong>eager</strong> (sometimes called <strong>greedy</strong>), in the sense that they will always match to as many repetitions as they possibly can while satisfying the rules. However, you can reverse this behaviour and make a quantifier <strong>lazy</strong> by appending <code>?</code> immediately after the quantifier. A lazy quantifier will match against the fewest number of repetitions as possible while still satisfying the rule. Here’s what that looks like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string    =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"ab"</span>, <span class="st">"abb"</span>, <span class="st">"abbb"</span>, <span class="st">"abbbb"</span>, <span class="st">"abbbbb"</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab??</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab??"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab*?</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab*?"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab+?</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab+?"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2}?</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2}?"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2,}?</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2,}?"</span>, <span class="at">match =</span> <span class="cn">NA</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">ab{2,4}?</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_view</span>(string, <span class="at">pattern =</span> <span class="st">"ab{2,4}?"</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<pre># A tibble: 6 × 7
  string `ab??`     `ab*?`     `ab+?`     `ab{2}?`   `ab{2,}?`  `ab{2,4}?`
  <span style="color:#008080">&lt;chr&gt;</span>  <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span> <span style="color:#008080">&lt;strngr_v&gt;</span>
1 a      <span style="color:#008080">&lt;a&gt;</span>        <span style="color:#008080">&lt;a&gt;</span>        a          a          a          a         
2 ab     <span style="color:#008080">&lt;a&gt;</span>b       <span style="color:#008080">&lt;a&gt;</span>b       <span style="color:#008080">&lt;ab&gt;</span>       ab         ab         ab        
3 abb    <span style="color:#008080">&lt;a&gt;</span>bb      <span style="color:#008080">&lt;a&gt;</span>bb      <span style="color:#008080">&lt;ab&gt;</span>b      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>      <span style="color:#008080">&lt;abb&gt;</span>     
4 abbb   <span style="color:#008080">&lt;a&gt;</span>bbb     <span style="color:#008080">&lt;a&gt;</span>bbb     <span style="color:#008080">&lt;ab&gt;</span>bb     <span style="color:#008080">&lt;abb&gt;</span>b     <span style="color:#008080">&lt;abb&gt;</span>b     <span style="color:#008080">&lt;abb&gt;</span>b    
5 abbbb  <span style="color:#008080">&lt;a&gt;</span>bbbb    <span style="color:#008080">&lt;a&gt;</span>bbbb    <span style="color:#008080">&lt;ab&gt;</span>bbb    <span style="color:#008080">&lt;abb&gt;</span>bb    <span style="color:#008080">&lt;abb&gt;</span>bb    <span style="color:#008080">&lt;abb&gt;</span>bb   
6 abbbbb <span style="color:#008080">&lt;a&gt;</span>bbbbb   <span style="color:#008080">&lt;a&gt;</span>bbbbb   <span style="color:#008080">&lt;ab&gt;</span>bbbb   <span style="color:#008080">&lt;abb&gt;</span>bbb   <span style="color:#008080">&lt;abb&gt;</span>bbb   <span style="color:#008080">&lt;abb&gt;</span>bbb  
</pre>
</div>
<p>Obviously, some of those are silly. There’s no point whatsoever in writing a regular expression like <code>ab{2,4}?</code>, because it produces exactly the same behaviour as <code>ab{2}</code>. Nevertheless, there are some instances where lazy quantifiers turn out to be useful, so I’m mentioning them here just in case I come back in tears next year trying to figure out how the accursed things work.</p>
<p>In everyday life I find that 95% of the time the only quantifiers I ever need are <code>?</code>, <code>*</code>, and <code>+</code>, but every now and then I find a need to use the more flexible <code>{}</code> notation. To give one example of this, I’ll use a recent <a href="https://bsky.app/profile/midnightpals.bsky.social/post/3ld7vr34nok2n">Midnight Pals thread</a>, which I loaded earlier as the <code>midnight</code> vector. If you’re not a regular reader of Midnight Pals, it’s essentially a literary satire that makes oblique references to current events. Edgar Allen Poe, Stephen King, Clive Barker, and Mary Shelley are recurring characters, for instance. So too is JK Rowling, though she doesn’t associate with the other characters and instead tends to live in her own “mysterious circle of robed figures”. To give you a sense of what the dialog typically looks like, here’s the first few lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(midnight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] "[mysterious circle of robed figures]"            
[2] "JK Rowling: hello children"                      
[3] "Rowling: what newsss, wormtongue?"               
[4] "Rowling: how goes the infiltration of bluesssky?"
[5] "Jesse Singal: mommy mommy"                       
[6] "Singal: it was SO HARD"                          
</pre>
</div>
<p>As illustrated in this extract, one of the conceits of the JKR character is that she hisses many of her lines<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and so the text often contains words like <code>"bluesssky"</code> or <code>"transssses"</code>. So let’s see if we can write a regular expression to detect the hissed words. The actual number of <code>s</code>-repetitions in the JKR dialog varies of course, so we might want to use a regular expression like <code>s{3,}</code> to find instances of three or more successive <code>s</code> characters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(midnight, <span class="st">"s{3,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [3] │ Rowling: what new<span style="color:#008080">&lt;sss&gt;</span>, wormtongue?
 [4] │ Rowling: how goes the infiltration of blue<span style="color:#008080">&lt;sss&gt;</span>ky?
[17] │ Rowling: door'<span style="color:#008080">&lt;sss&gt;</span> open, boy<span style="color:#008080">&lt;sss&gt;</span>!
[20] │ Rowling: i know you did, je<span style="color:#008080">&lt;ssss&gt;</span>e
[22] │ Rowling: yess you did great je<span style="color:#008080">&lt;sss&gt;</span>e
[43] │ Rowling: patience, <span style="color:#008080">&lt;ssss&gt;</span>isster, we must bide our time
[54] │ Rowling: sure, je<span style="color:#008080">&lt;sss&gt;</span>e might look like a sniveling worm, a nasty crawling slithering little shit, a spineless craven buffoon
</pre>
</div>
<p>It doesn’t work perfectly (e.g., it misses the <code>"yess"</code> on line 22), but it’s not too bad given how simple the regex is. That said, it’s also a bit limited insofar as it only detects the hissing (i.e., the <code>s</code>-repetition). Ideally, we’d like a regular expression that captures the entire hissssssed word, but to do that we’ll need to get a little fancier, and dive a little deeper into regular expression syntax. We’ll return to that later.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="midnight1.png" class="img-fluid figure-img"></p>
<figcaption><a href="https://bsky.app/profile/midnightpals.bsky.social/post/3kzf6vtc6fl26">clive. clive don’t be an instigator</a></figcaption>
</figure>
</div>
</div></div></section>
<section id="backslashes-part-i" class="level2">
<h2 class="anchored" data-anchor-id="backslashes-part-i">Backslashes (part I)</h2>
<p>The discussion of quantifiers leads to the natural question: what if I don’t want to use <code>?</code> as a quantifier, and instead want to match a literal <code>?</code> in the string. To do that we can <strong>escape</strong> the special character by prefixing it with a backslash. That is, within a regular expression we would write <code>\?</code> to match a literal <code>?</code>.</p>
<p>It gets complicated, though, because the way we represent the regular expression is via an R string,<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> and <code>\</code> has a special meaning in R strings, because it’s used as an escape character in R too. So if we want to “pass” a literal <code>\</code> into the regular expression, the thing we need to type in R is <code>"\\"</code>. This is… confusing. I find this helps:</p>
<ul>
<li>write <code>"\\+"</code> in R to mean <code>\+</code> in the regex, and match a literal <code>+</code></li>
<li>write <code>"\\?"</code> in R to mean <code>\?</code> in the regex, and match a literal <code>?</code></li>
<li>write <code>"\\*"</code> in R to mean <code>\*</code> in the regex, and match a literal <code>*</code></li>
<li>write <code>"\\{"</code> in R to mean <code>\{</code> in the regex, and match a literal <code>{</code></li>
</ul>
<p>Notice the notation I’ve used here: when I enclose a string in quotation marks I’m referring to the string as it has to be specified in R, but when the quote marks are missing I am referring to the raw contents of the string/regex.</p>
<p>In any case, since we are using <code>\</code> as the escape character, it follows that it too is considered a special character in regular expression syntax. As such, you have to escape the backslash if you want to treat it as a literal:</p>
<ul>
<li>write <code>"\\\\"</code> in R to mean <code>\\</code> in the regex, and match a literal <code>\</code></li>
</ul>
<p>Not particularly pleasant, and as you can imagine it is very easy to write regular expressions that use the wrong number of backslashes and end up in tears.</p>
<p>In any case, here’s an example. If I want to find all the question marks in the <code>femininomenon</code> lyrics, this is what I would have to do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"</span><span class="sc">\\</span><span class="st">?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[18] │ Um, can you play a song with a fucking beat<span style="color:#008080">&lt;?&gt;</span>
[47] │ Dude, can you play a song with a fucking beat<span style="color:#008080">&lt;?&gt;</span>
[63] │ But does it happen<span style="color:#008080">&lt;?&gt;</span> (No)
[64] │ But does it happen<span style="color:#008080">&lt;?&gt;</span> (No)
[66] │ (A what<span style="color:#008080">&lt;?&gt;</span>) A femininomenon
[76] │ Did you hear me<span style="color:#008080">&lt;?&gt;</span> Play the fucking beat
</pre>
</div>
<p>It should also be noted that a similar thing happens with regards to special characters like <code>\n</code> (line feed) that contain a backslash in their notation. The line feed character has no special meaning in a regular expression, but because you need to pass the textual representation from the R string down to the regular expression, you have to escape the backslash. That is:</p>
<ul>
<li>write <code>"\\n"</code> in R to mean <code>\n</code> in the regex, and match a line feed</li>
<li>write <code>"\\t"</code> in R to mean <code>\t</code> in the regex, and match a tab</li>
</ul>
<p>I’ll return to this in a later section, because there are other characters that need to be escaped. But these are the ones we need for now.</p>
</section>
<section id="character-sets" class="level2">
<h2 class="anchored" data-anchor-id="character-sets">Character sets</h2>
<p>Earlier in the post we encountered the irritating problem of capital letters. If we want to detect all lines where Chappell Roan sings <code>"you"</code> or <code>"your"</code> without worrying about capitalisation, we need a way of describing “a single character that can either be <code>y</code> or <code>Y</code>”. We can do this by defining a <strong>character set</strong> (sometimes referred to as a <strong>category</strong> or <strong>class</strong>) by enclosing the set of allowed characters in square brackets. For example, the character set <code>[yY]</code> will match to a single instance of <code>y</code> or a single instance of <code>Y</code>. Our regular expression now becomes <code>"[Yy]our?"</code>, as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[Yy]our?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [3] │ Got so close but then <span style="color:#008080">&lt;you&gt;</span> lost it
 [4] │ Should've listened to <span style="color:#008080">&lt;your&gt;</span> friends
 [6] │ <span style="color:#008080">&lt;You&gt;</span> sent him pictures and playlists and phone sex
 [7] │ He disappeared from the second that <span style="color:#008080">&lt;you&gt;</span> said
[18] │ Um, can <span style="color:#008080">&lt;you&gt;</span> play a song with a fucking beat?
[32] │ <span style="color:#008080">&lt;You&gt;</span> pretend to love his mother
[33] │ Lying to <span style="color:#008080">&lt;your&gt;</span> friends about
[35] │ Stuck in the suburbs, <span style="color:#008080">&lt;you&gt;</span>'re folding his laundry
[36] │ Got what <span style="color:#008080">&lt;you&gt;</span> wanted, so stop feeling sorry
[47] │ Dude, can <span style="color:#008080">&lt;you&gt;</span> play a song with a fucking beat?
[60] │ Ladies, <span style="color:#008080">&lt;you&gt;</span> know what I mean
[61] │ And <span style="color:#008080">&lt;you&gt;</span> know what <span style="color:#008080">&lt;you&gt;</span> need
[76] │ Did <span style="color:#008080">&lt;you&gt;</span> hear me? Play the fucking beat
</pre>
</div>
<p>You can apply quantifiers to character sets, but you need to be a little careful about this. Let’s say I have the character set <code>[femino]</code>, and I want to apply the quantifier <code>{4,}</code> to detect four or more repetitions of the character set. The regular expression <code>[femino]{4,}</code> will match against literal repetitions like <code>"oooo"</code> or <code>"mmmmm"</code>, but it will also match to words like <code>"omen"</code> and <code>"feminine"</code> because every letter in those words belongs to the character set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[femino]{4,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [8] │ "Let's get c<span style="color:#008080">&lt;offee&gt;</span>, let's meet up"
[24] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[28] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[53] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[57] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[65] │ Well, what we really need is a <span style="color:#008080">&lt;femininomenon&gt;</span>
[66] │ (A what?) A <span style="color:#008080">&lt;femininomenon&gt;</span>
[72] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[82] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[86] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[90] │ Make a bitch, it's a fem (It's a <span style="color:#008080">&lt;femininomenon&gt;</span>)
</pre>
</div>
<p>… oh yeah, it also matches the <code>"offee"</code> in <code>"coffee"</code>.</p>
<section id="ranges-and-shorthand-notation" class="level3">
<h3 class="anchored" data-anchor-id="ranges-and-shorthand-notation">Ranges and shorthand notation</h3>
<p>When referring to alphabetic characters or digits, you can use a hyphen within a character set to define a <strong>range</strong> of characters. For example, <code>[0-9]</code> is essentially a shorthand for <code>[0123456789]</code> and <code>[a-e]</code> is short hand for <code>[abcde]</code>. You can define multiple ranges within a single character set, so <code>[a-zA-Z0-9]</code> will match against alphanumeric characters.</p>
<p>Some character sets are used so often that there is a shorthand notation for them:</p>
<ul>
<li><code>\d</code> denotes digits, and is equivalent to <code>[0-9]</code></li>
<li><code>\w</code> denotes word characters. At a minimum it supports alphanumeric characters, but it will also match against unicode characters used in words.</li>
<li><code>\s</code> denotes whitespace characters, and will match a space <code>" "</code>, a tab <code>"\t"</code>, a carriage return <code>"\r"</code>, a line feed <code>"\n"</code>, or a form feed <code>"\f"</code>; as well as unicode separator characters if the regex flavour supports unicode</li>
</ul>
<p>There are a variety of other shorthand classes too. If you look in the base R documentation, for instance, you’ll find reference to various “POSIX classes” like <code>:digit:</code> and <code>:punct:</code> that do something similar. Over time I’ve become wary about these because they aren’t implemented consistently across regex flavours (see later), so I try to avoid them.</p>
<p>To illustrate how to use these pre-specified character sets, I’ll do a little bit of regular expression matching on the opening lines to <a href="https://genius.com/Harry-nilsson-one-lyrics">One</a> by Harry Nilsson, where I’ve used digits to represent the numbers rather than spelling out the words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1 is the loneliest number that you'll ever do"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2 can be as bad as 1"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"It's the loneliest number since the number 1"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To detect the digits in this text, the regular expression we need is just the character set <code>\d</code> itself. The only nuance here is that we have to specify the regex as an R string, so we have to type <code>"\\d"</code> in R in order to get what we want:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(one, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ <span style="color:#008080">&lt;1&gt;</span> is the loneliest number that you'll ever do
[2] │ <span style="color:#008080">&lt;2&gt;</span> can be as bad as <span style="color:#008080">&lt;1&gt;</span>
[3] │ It's the loneliest number since the number <span style="color:#008080">&lt;1&gt;</span>
</pre>
</div>
<p>Alternatively, suppose I want to detect all words in the text. One approach (which doesn’t quite work – we’ll come back to this later) would be to look for consecutive sequences of word characters, which we could specify using <code>\w+</code> as the regular expression and, to belabour the point, writing <code>"\\w+"</code> as the R string that specifies that regular expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(one, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ <span style="color:#008080">&lt;1&gt;</span> <span style="color:#008080">&lt;is&gt;</span> <span style="color:#008080">&lt;the&gt;</span> <span style="color:#008080">&lt;loneliest&gt;</span> <span style="color:#008080">&lt;number&gt;</span> <span style="color:#008080">&lt;that&gt;</span> <span style="color:#008080">&lt;you&gt;</span>'<span style="color:#008080">&lt;ll&gt;</span> <span style="color:#008080">&lt;ever&gt;</span> <span style="color:#008080">&lt;do&gt;</span>
[2] │ <span style="color:#008080">&lt;2&gt;</span> <span style="color:#008080">&lt;can&gt;</span> <span style="color:#008080">&lt;be&gt;</span> <span style="color:#008080">&lt;as&gt;</span> <span style="color:#008080">&lt;bad&gt;</span> <span style="color:#008080">&lt;as&gt;</span> <span style="color:#008080">&lt;1&gt;</span>
[3] │ <span style="color:#008080">&lt;It&gt;</span>'<span style="color:#008080">&lt;s&gt;</span> <span style="color:#008080">&lt;the&gt;</span> <span style="color:#008080">&lt;loneliest&gt;</span> <span style="color:#008080">&lt;number&gt;</span> <span style="color:#008080">&lt;since&gt;</span> <span style="color:#008080">&lt;the&gt;</span> <span style="color:#008080">&lt;number&gt;</span> <span style="color:#008080">&lt;1&gt;</span>
</pre>
</div>
<p>You can see why this doesn’t quite do what we want: the apostrophe is not a word character, and it doesn’t get detected. There’s a better approach to this using word boundaries, but I’ll come to that later when talking about anchors.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="one1.jpg" class="img-fluid figure-img"></p>
<figcaption>I prefer the Aimee Mann cover</figcaption>
</figure>
</div>
</section>
<section id="logical-operations-with-character-sets" class="level3">
<h3 class="anchored" data-anchor-id="logical-operations-with-character-sets">Logical operations with character sets</h3>
<p>To some extent you can perform logical operations on character sets: set negation, set union, set intersection, add set subtraction. These operations are all supported by regular expressions, but this is another thing where the implementation varies a little across regular expression flavours. So let’s talk about these in turn.</p>
<p>Of the various operations, set union is the easiest one to describe. We’ve already talked about it. If you want to take the union of two character sets, all you have to do is concatenate them in the description. The lower case letters are represented by the range <code>[a-z]</code>, and the upper case letters are represented by <code>[A-Z]</code>. The union of these classes is simply <code>[a-zA-Z]</code>. These are set operations, so it doesn’t matter if you include the same element multiple times: <code>[aab]</code> is the same character set as <code>[ab]</code>.</p>
<p>The second easiest one to talk about is negation. If you want to represent “any character except the ones listed”, use <code>[^</code> to begin the set rather than <code>[</code>. For example, the set <code>[^femino ]</code> is comprised of all characters except those seven (six letters plus the space). If I wanted to detect all instances where the Chappell Roan lyrics contain five or more consecutive characters that don’t include these letters, I’d do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[^femino ]{5,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [4] │ Sho<span style="color:#008080">&lt;uld'v&gt;</span>e listened to your friends
 [6] │ You sent him pictures and <span style="color:#008080">&lt;playl&gt;</span>ists and phone sex
[24] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[28] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[35] │ <span style="color:#008080">&lt;Stuck&gt;</span> in the <span style="color:#008080">&lt;suburbs,&gt;</span> you're folding his laundry
[53] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[57] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[66] │ (A <span style="color:#008080">&lt;what?)&gt;</span> A femininomenon
[72] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[82] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[86] │ <span style="color:#008080">&lt;(It's&gt;</span> a fem) It's a femininomenon
[88] │ <span style="color:#008080">&lt;[Outr&gt;</span>o]
[90] │ Make a bitch, it's a fem <span style="color:#008080">&lt;(It's&gt;</span> a femininomenon)
</pre>
</div>
<p>Yeah, fair enough.</p>
<p>Before moving on to other kinds of set logic, it’s worth being explicit about what the <code>[^</code> notation implies about including <code>^</code> in a character set. The short answer is that <code>^</code> only has the special meaning of “negation operator” if it follows immediately after the <code>[</code>. In other words, the sets <code>[ab^]</code> and <code>[a^b]</code> are identical and will match against any literal <code>a</code>, <code>b</code>, or <code>^</code> that appears in the text. However, <code>[^ab]</code> is a different set entirely, because in this context <code>^</code> is interpreted as the negation operator and this will match against anything that is not an <code>a</code> or a <code>b</code>. As an illustration, let’s match against five or more repetitions of <code>[femino ^]</code>, and compare it to what we got last time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[femino ^]{5,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [8] │ "Let's get c<span style="color:#008080">&lt;offee&gt;</span>, let's meet up"
 [9] │ I'm so sick<span style="color:#008080">&lt; of on&gt;</span>line love
[23] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[24] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[27] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[28] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[38] │ I'm so sick<span style="color:#008080">&lt; of on&gt;</span>line love
[52] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[53] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[56] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[57] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[65] │ Well, what we really need is a<span style="color:#008080">&lt; femininomenon&gt;</span>
[66] │ (A what?) A<span style="color:#008080">&lt; femininomenon&gt;</span>
[71] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[72] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[75] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[81] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[82] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
[85] │ (Make a bitch) Make a bitch g<span style="color:#008080">&lt;o on &gt;</span>and on
[86] │ (It's a fem) It's a<span style="color:#008080">&lt; femininomenon&gt;</span>
... and 1 more
</pre>
</div>
<p>Not surprisingly, this is a very different result.</p>
<p>Finally, I want to briefly talk about subtraction and intersection. This is where things get tricky in R because these <em>do</em> work in tidyverse regular expressions but do not work in base R regexes, due to the differences in the regular expression engines underneath. In some regex flavours (including the one used in tidyverse), you can use a minus sign <code>-</code> to denote set difference, so it would be entirely valid to use <code>[[a-z]-[aeiou]]</code> to represent lower case consonants. Similarly, you can use <code>&amp;&amp;</code> to represent intersection, so <code>[[a-z]]&amp;&amp;[Papa]</code> would be equivalent to <code>[pa]</code>. This notation works in tidyverse (more detail on this later), as illustrated below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[[a-z]-[femino]]{5,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [6] │ You sent him pictures and <span style="color:#008080">&lt;playl&gt;</span>ists and phone sex
[35] │ Stuck in the <span style="color:#008080">&lt;suburbs&gt;</span>, you're folding his laundry
</pre>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"[[a-z]&amp;&amp;[Papa]]{3,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [7] │ He dis<span style="color:#008080">&lt;app&gt;</span>eared from the second that you said
[22] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[26] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[51] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[55] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[63] │ But does it h<span style="color:#008080">&lt;app&gt;</span>en? (No)
[64] │ But does it h<span style="color:#008080">&lt;app&gt;</span>en? (No)
[70] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[74] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[80] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
[84] │ (Get it hot) Get it hot like P<span style="color:#008080">&lt;apa&gt;</span> John
</pre>
</div>
<p>Be warned, however: it does not work in base R.</p>
</section>
</section>
<section id="anchors-and-boundaries" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="anchors-and-boundaries">Anchors and boundaries</h2>
<p>Next on Danielle’s list of “tedious regular expression concepts” are <strong>anchors</strong>. There are two special characters that are used to represent “start of string” and “end of string”:</p>
<ul>
<li>When used outside of a character set, <code>^</code> denotes “start of string”</li>
<li>When used outside of a character set, <code>$</code> denotes “end of string”</li>
</ul>
<p>In my little notes-to-self I always phrase it like this because when you use these characters inside square brackets they are <em>not</em> interpreted as anchors, and sometimes I forget this nuance.</p>
<p>As an example of how to use these anchors, let’s say I want to detect the first word in every line in “Femininomenon”, but only if that word starts with the capital letter <code>L</code>. The regular expression <code>^L</code> will match against any <code>L</code> that appears as the first character in the string, so a first-pass attempt at solving this problem might be to try something like <code>^L\w*</code> (i.e., match a starting <code>L</code> followed by zero or more word characters). It’s not the most robust way to solve the problem, but it works just fine in this case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"^L</span><span class="sc">\\</span><span class="st">w*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[33] │ <span style="color:#008080">&lt;Lying&gt;</span> to your friends about
[60] │ <span style="color:#008080">&lt;Ladies&gt;</span>, you know what I mean
</pre>
</div>
<p>The same logic works for end of string. In the example below we have a regular expression that detects the final word in the line, but only if it starts with a lower-case <code>f</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"f</span><span class="sc">\\</span><span class="st">w*$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [4] │ Should've listened to your <span style="color:#008080">&lt;friends&gt;</span>
[15] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[24] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[28] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[44] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[53] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[57] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[65] │ Well, what we really need is a <span style="color:#008080">&lt;femininomenon&gt;</span>
[66] │ (A what?) A <span style="color:#008080">&lt;femininomenon&gt;</span>
[72] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[82] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[86] │ (It's a fem) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[92] │ Make a bitch, it's a fem, fem, fem, <span style="color:#008080">&lt;fem&gt;</span>
</pre>
</div>
<p>About 99% of my use of anchors is either <code>$</code> or <code>^</code> but there are other anchors. It varies across regex flavours, but generally you can use <code>\A</code> the same way you use <code>^</code> to represent start of string, and <code>\Z</code> to represent end of string. Personally I don’t like these alternatives, because I keep incorrectly thinking that they have some meaningful relationship to alphabetic characters. The <code>^</code> and <code>$</code> notation is pretty arbitrary, but at least it’s not actively misleading in the way that <code>\A</code> and <code>\Z</code> are.</p>
<p>A closely related concept to anchors is the idea of a <strong>boundary</strong>. Anchors and boundaries are both examples of “zero-length matches”, in the sense that they don’t match against a specific character, they match against a position in the text. A word boundary <code>\b</code> (the only kind of boundary I am aware of, though there might be others) matches against a position that is followed by a word character (i.e., anything that is matched by <code>\w</code>), but is preceded by a non-word character <em>or vice versa</em>. Informally stated, <code>\b</code> matches a start-of-word boundary and an end-of-word boundary.</p>
<p>As a simple example, suppose we want to match only those instances in “Femininomenon” where <code>"fem"</code> is used as a word. If we don’t consider word boundaries, this doesn’t quite work because it matches the first three characters in <code>"femininomenon"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"fem"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[15] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[24] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[28] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[44] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[53] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[57] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[65] │ Well, what we really need is a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[66] │ (A what?) A <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[72] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[82] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[86] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon
[90] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span> (It's a <span style="color:#008080">&lt;fem&gt;</span>ininomenon)
[92] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>
</pre>
</div>
<p>We can tighten our regex by specifying that <code>"fem"</code> must have word boundaries on either side. The regular expression now becomes <code>\bfem\b</code>, so the command we type in R looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"</span><span class="sc">\\</span><span class="st">bfem</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[15] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[24] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[28] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[44] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[53] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[57] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[72] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[82] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[86] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a femininomenon
[90] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span> (It's a femininomenon)
[92] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>
</pre>
</div>
<p>Much better! Notice also that “end of string” and “start of string” do count as a word boundaries. On lines 15, 44, and 92, the line ends in the word <code>"fem"</code> and our regular expression captures these cases.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="femmes.jpg" class="img-fluid figure-img"></p>
<figcaption>Pretend I made a boring regex pun about the femmes being “so strung out” here</figcaption>
</figure>
</div>
</div></div></section>
<section id="groups" class="level2">
<h2 class="anchored" data-anchor-id="groups">Groups</h2>
<p>The next regular expression concept to talk about are <strong>groups</strong>. At it’s most basic, a group is a sequence of characters that is treated as if it were a single character for the purposes of quantification etc.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> We can do this by enclosing the characters in parentheses, e.g., <code>(fem)</code> is a group that corresponds to the specific sequence <code>fem</code>. For example, let’s suppose I want to match against <code>"fem"</code> or <code>"femininomenon"</code>. There are lots of ways I could do this, but one of my favourite approaches to this would be to define <code>(ininomenon)</code> as a group, and then declare that this group is optional using the <code>?</code> quantifier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(femininomenon, <span class="st">"fem(ininomenon)?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[15] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[24] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[28] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[44] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>
[53] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[57] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[65] │ Well, what we really need is a <span style="color:#008080">&lt;femininomenon&gt;</span>
[66] │ (A what?) A <span style="color:#008080">&lt;femininomenon&gt;</span>
[72] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[82] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[86] │ (It's a <span style="color:#008080">&lt;fem&gt;</span>) It's a <span style="color:#008080">&lt;femininomenon&gt;</span>
[90] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span> (It's a <span style="color:#008080">&lt;femininomenon&gt;</span>)
[92] │ Make a bitch, it's a <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>, <span style="color:#008080">&lt;fem&gt;</span>
</pre>
</div>
<p>This can be handy if a particular sequence that you want to match might be repeated as a whole. Let’s say I want to match <code>"in"</code>, <code>"inin"</code>, and <code>"ininin"</code> but not match <code>"inn"</code>. We could do this cleanly with a regular expression like <code>(in)+</code>, though if we want to prevent it from matching the <code>"in"</code> in <code>"inn"</code> we should also specify that the pattern should be preceded and followed by word boundaries. That is, this <em>almost</em> works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"i in inin ininin inn out"</span>, <span class="st">"(in)+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ i <span style="color:#008080">&lt;in&gt;</span> <span style="color:#008080">&lt;inin&gt;</span> <span style="color:#008080">&lt;ininin&gt;</span> <span style="color:#008080">&lt;in&gt;</span>n out
</pre>
</div>
<p>This actually works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"i in inin ininin inn out"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">b(in)+</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ i <span style="color:#008080">&lt;in&gt;</span> <span style="color:#008080">&lt;inin&gt;</span> <span style="color:#008080">&lt;ininin&gt;</span> inn out
</pre>
</div>
</section>
<section id="pipes-as-or-operators" class="level2">
<h2 class="anchored" data-anchor-id="pipes-as-or-operators">Pipes as “or” operators</h2>
<p>One of the more basic features in regular expressions is that when <code>|</code> is used outside of a category, it is interpreted as an “or” operator that is evaluated left to right. It’s so basic that I feel weird about delaying discussion of <code>|</code> until this late in the post, but in practice I find that I use it most often in conjunction with groups and character sets, so I wanted to wait until I’d talked about those concepts first.</p>
<p>This time I’ll use the lyrics to <a href="https://www.youtube.com/watch?v=kLbn61Z4LDI">Feather</a> by Sabrina Carpenter as the source text, and I’ll look for all instances where she sings the word “feather” or the phrase “no duh”. No, I don’t know why I chose those two, but let’s run with it. A regular expression that does this, taking potential capitalisation into account, would be <code>([Ff]eather)|([Nn]o duh)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(feather, <span class="st">"([Ff]eather)|([Nn]o duh)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[19] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind (Ah)
[23] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you out my life
[29] │ Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, yeah
[44] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind (Ah)
[48] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you out my life
[55] │ Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>
[59] │ You miss me? <span style="color:#008080">&lt;No duh&gt;</span>
[62] │ You miss me? <span style="color:#008080">&lt;No duh&gt;</span> (<span style="color:#008080">&lt;No duh&gt;</span>)
[67] │ (I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind)
[68] │ You miss me? <span style="color:#008080">&lt;No duh&gt;</span>
[70] │ (Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>)
[72] │ (I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind)
[73] │ You miss me? <span style="color:#008080">&lt;No duh&gt;</span>
[75] │ (Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, yeah)
</pre>
</div>
<p>In this example, there’s no possible way in which a string can match against both the left hand side and the right hand side, so in this case the order of the two groups doesn’t matter. But that’s not always the case. Let’s suppose I want to match against the exact word “feather”, <em>or</em> match against a substring inside a word that starts with the letter <code>f</code> and ends in the letter <code>t</code> (we can do this with <code>(f\w*t)</code> as the regex). Should we match the entire word <code>"feather"</code> or only match the <code>"feat"</code> part of the word? It depends on the order in which the two groups are specified.</p>
<p>To see the difference compare this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(feather, <span class="st">"(feather)|(f</span><span class="sc">\\</span><span class="st">w*t)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[15] │ I got you blocked, a<span style="color:#008080">&lt;ft&gt;</span>er this, an a<span style="color:#008080">&lt;fterthought&gt;</span>
[19] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind (Ah)
[22] │ You <span style="color:#008080">&lt;fit&gt;</span> every stereotype, "Send a pic"
[23] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you out my life
[29] │ Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, yeah
[44] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind (Ah)
[47] │ You <span style="color:#008080">&lt;fit&gt;</span> every stereotype, "Send a pic"
[48] │ I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you out my life
[55] │ Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>
[67] │ (I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind)
[70] │ (Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>)
[72] │ (I feel so much lighter like a <span style="color:#008080">&lt;feather&gt;</span> with you off my mind)
[75] │ (Like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, like a <span style="color:#008080">&lt;feather&gt;</span>, yeah)
</pre>
</div>
<p>to this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(feather, <span class="st">"(f</span><span class="sc">\\</span><span class="st">w*t)|(feather)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[15] │ I got you blocked, a<span style="color:#008080">&lt;ft&gt;</span>er this, an a<span style="color:#008080">&lt;fterthought&gt;</span>
[19] │ I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you off my mind (Ah)
[22] │ You <span style="color:#008080">&lt;fit&gt;</span> every stereotype, "Send a pic"
[23] │ I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you out my life
[29] │ Like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, yeah
[44] │ I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you off my mind (Ah)
[47] │ You <span style="color:#008080">&lt;fit&gt;</span> every stereotype, "Send a pic"
[48] │ I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you out my life
[55] │ Like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her
[67] │ (I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you off my mind)
[70] │ (Like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her)
[72] │ (I feel so much lighter like a <span style="color:#008080">&lt;feat&gt;</span>her with you off my mind)
[75] │ (Like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, like a <span style="color:#008080">&lt;feat&gt;</span>her, yeah)
</pre>
</div>
<p>As this illustrates, if a match is detected on the left hand side of the <code>|</code> the regular expression engine uses that match. It won’t use the right hand side if there’s already a match on the left. Admittedly, I’ve been a bit lazy in this by not taking word boundaries or capitalisation into account. You’d probably want something a little more elaborate in real life, but it’s such a silly example that I’ve erred on the side of simplicity here so that you can see the difference that order makes.</p>
</section>
<section id="dots-as-any-character" class="level2">
<h2 class="anchored" data-anchor-id="dots-as-any-character">Dots as “any” character</h2>
<p>It may surprise the reader (it surprised the author) that I’ve managed to get this far into the post without ever talking about the <code>.</code> metacharacter. This is partly accidental, partly deliberate. The <code>.</code> is a powerful and easily-misused tool: it matches <em>any</em> character except line breaks. There’s a whole article on <a href="https://www.regular-expressions.info/dot.html">the dot</a> that cautious novice regex users to be careful when using it… so I am trying to teach myself to be careful and not use it so often!</p>
<p>An example of why it’s sometimes counterintuitive. Suppose I want to match the text in each line of “Feather” up to the point that <code>"ignore"</code> appears, and then terminate the match. It’s very tempting to use <code>.*ignore</code> as the regular expression, but that doesn’t quite do what we expect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(feather, <span class="st">".*ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[13] │ <span style="color:#008080">&lt;I slam the door, I hit ignore&gt;</span>
[38] │ <span style="color:#008080">&lt;I slam the door (Slam the door), I hit ignore (Hit ignore&gt;</span>)
</pre>
</div>
<p>Because the <code>*</code> operator is greedy, it “consumes” every instance of <code>"ignore"</code> except the last one, which is then matched by the explicitly stated <code>"ignore"</code> in the regex. As a consequence, the regex I’ve written here matches all the text up to and including the last <code>"ignore"</code> that appears in the line, so it matches incorrectly on line 38.</p>
<p>We can fix this by tightening the quantification. Instead of using a greedy operator <code>*</code> that matches as much text as possible, we can use the lazy version <code>*?</code> that matches as little as possible:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(feather, <span class="st">".*?ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[13] │ <span style="color:#008080">&lt;I slam the door, I hit ignore&gt;</span>
[38] │ <span style="color:#008080">&lt;I slam the door (Slam the door), I hit ignore&gt;</span><span style="color:#008080">&lt; (Hit ignore&gt;</span>)
</pre>
</div>
<p>Now we get the right answer.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="feather1.jpg" class="img-fluid figure-img"></p>
<figcaption>When I use <code>.*</code> in my regex</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="feather2.jpg" class="img-fluid figure-img"></p>
<figcaption>When I check what <code>.*</code> matches</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="intermission-very-important-applied-regex" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="intermission-very-important-applied-regex">Intermission: Very important applied regex</h2>
<p>This post is getting long. We need a little break. Well, I need a little break. As it happens, we’ve now introduced enough regular expression concepts that we can detect all the hissed words in the “Midnight Pals” dialog hissed by the JK Rowling character. Here they are:</p>
<p><br></p>
<div class="cell column-page">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(midnight, <span class="st">"</span><span class="sc">\\</span><span class="st">b((</span><span class="sc">\\</span><span class="st">w|')*s{3,}(</span><span class="sc">\\</span><span class="st">w|')*)|(yess)</span><span class="sc">\\</span><span class="st">b"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [3] │ Rowling: what <span style="color:#008080">&lt;newsss&gt;</span>, wormtongue?
 [4] │ Rowling: how goes the infiltration of <span style="color:#008080">&lt;bluesssky&gt;</span>?
[17] │ Rowling: <span style="color:#008080">&lt;door'sss&gt;</span> open, <span style="color:#008080">&lt;boysss&gt;</span>!
[20] │ Rowling: i know you did, <span style="color:#008080">&lt;jesssse&gt;</span>
[22] │ Rowling: <span style="color:#008080">&lt;yess&gt;</span> you did great <span style="color:#008080">&lt;jessse&gt;</span>
[43] │ Rowling: patience, <span style="color:#008080">&lt;ssssisster&gt;</span>, we must bide our time
[54] │ Rowling: sure, <span style="color:#008080">&lt;jessse&gt;</span> might look like a sniveling worm, a nasty crawling slithering little shit, a spineless craven buffoon
</pre>
</div>
<p><br></p>
<p>For a variety of reasons this makes me happy. But let’s move on, shall we?</p>
</section>
<section id="backreferences" class="level2">
<h2 class="anchored" data-anchor-id="backreferences">Backreferences</h2>
<p>At this point we’re starting to get into the weeds. I’ve talked about most of the core features of regular expressions, and to be honest I’d guess that 95% of my regex usage can be accounted for using only the tools described so far. But there are many more fancy tricks you can do with regexes, and the one I use most often is <strong>backreferencing</strong>.</p>
<p>Here’s an example. Suppose we are listening to <a href="https://www.youtube.com/watch?v=wlfE_IplWAU">classical music</a>, and we decide we want to detect every instance of a word in <a href="https://www.youtube.com/watch?v=X53ZSxkQ3Ho">Baby Got Back</a> that begins and ends with the letter <code>a</code>. We can do this using the tools we already know. The regular expression <code>a\w+a</code> will match against strings of characters start and end with <code>a</code>, so we can extend that to require a <em>word</em> starts and end with <code>a</code> by placing a word boundary on either side, giving us <code>\ba\w+a\b</code> as the regular expression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(babygotback, <span class="st">"</span><span class="sc">\\</span><span class="st">ba</span><span class="sc">\\</span><span class="st">w+a</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[85] │ My <span style="color:#008080">&lt;anaconda&gt;</span> don't want none
</pre>
</div>
<p>But now suppose that we want to relax this slightly and find all words that start and end with the same (case-matched) letter, regardless of what that letter actually is. For that to work, we need to have the ability to <em>capture</em> one part of the regular expression, and then <em>refer</em> back to the captured contents elsewhere in the regular expression. The capturing part is straightforward, actually. Earlier when I introduced the <code>()</code> notation for groups, I was a little imprecise in my language. By default, anything enclosed in parentheses is treated as a <strong>capture group</strong>, and you can refer back to them numerically: <code>\1</code> is a backreference to the first capture group, <code>\2</code> refers to the second one, and so one.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>To give a simple example, imagine a markup language in which footnotes are specified using markers like <code>%a%</code>, <code>%b%</code> and so on, and the marker would need to appear on either side of the footnote text itself. Some example strings that you might see:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>comments <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"some text %a%footnote%a% some text"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"%a% none of this %b% is a footnote"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"some more text %b%another footnote%b%"</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now consider the regular expression <code>%[a-z]%</code>. This will match against <code>%a%</code>, <code>%b%</code> and so on. Let’s have a look at what it detects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(comments, <span class="st">"%[a-z]%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ some text <span style="color:#008080">&lt;%a%&gt;</span>footnote<span style="color:#008080">&lt;%a%&gt;</span> some text
[2] │ <span style="color:#008080">&lt;%a%&gt;</span> none of this <span style="color:#008080">&lt;%b%&gt;</span> is a footnote
[3] │ some more text <span style="color:#008080">&lt;%b%&gt;</span>another footnote<span style="color:#008080">&lt;%b%&gt;</span>
</pre>
</div>
<p>Next we need to specify this as a capture group, which we do by wrapping it in parentheses. That gives us <code>(%[a-z]%)</code> as our regular expression. Because the content of this group is captured, I can insert a <code>\1</code> to refer to the specific text matched by that group. So we could build a regular expression like <code>(%[a-z]%).*+\1</code>, which looks for a footnote marker like <code>%a%</code> or <code>%b%</code>, followed by some arbitrary text, and then followed by a <em>matching</em> footnote marker:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(comments, <span class="st">"(%[a-z]%).*</span><span class="sc">\\</span><span class="st">1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ some text <span style="color:#008080">&lt;%a%footnote%a%&gt;</span> some text
[3] │ some more text <span style="color:#008080">&lt;%b%another footnote%b%&gt;</span>
</pre>
</div>
<p>It’s a little bit risky to use the <code>.*</code> (as I discussed earlier), but it works for this particular problem, and hopefully you get the basic idea.</p>
<p>Armed with this newfound knowledge, we can return to the <em>Baby Got Backreferences</em> problem. Earlier on I used the expression <code>\ba\w+a\b</code> to detect words that start and end with the letter <code>a</code>. To generalise this to “words that start and end with the same letter”, I can replace the first <code>a</code> in this expression with a capture group that will match against any word character (i.e., <code>(\w)</code>), and then replace the second <code>a</code> with a backreference <code>\1</code> to that captured group. In other words, we started out with <code>\ba\w+a\b</code>, and we modify it to <code>\b(\w)\w+\1\b</code>. When specified as an R string, we need to add the extra backslashes as usual, and that gives us this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(babygotback, <span class="st">"</span><span class="sc">\\</span><span class="st">b(</span><span class="sc">\\</span><span class="st">w)</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">1</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [15] │ Wanna pull up tough 'cause you notice <span style="color:#008080">&lt;that&gt;</span> butt was stuffed
 [21] │ But <span style="color:#008080">&lt;that&gt;</span> butt you got makes (Me-me so horny)
 [24] │ Well, use me, use me 'cause you ain't <span style="color:#008080">&lt;that&gt;</span> average groupie
 [28] │ Take the average black man and ask him <span style="color:#008080">&lt;that&gt;</span>
 [33] │ Shake <span style="color:#008080">&lt;that&gt;</span> healthy butt, baby got back
 [43] │ And when I'm throwin' a <span style="color:#008080">&lt;gig&gt;</span>
 [51] │ So find <span style="color:#008080">&lt;that&gt;</span> juicy double
 [53] │ Beggin' for a piece of <span style="color:#008080">&lt;that&gt;</span> bubble
 [58] │ A word to the thick soul <span style="color:#008080">&lt;sisters&gt;</span>, I wanna get with ya
 [63] │ A lot of <span style="color:#008080">&lt;simps&gt;</span> won't like this song
 [65] │ And I'd <span style="color:#008080">&lt;rather&gt;</span> stay and play
 [78] │ Cosmo ain't got <span style="color:#008080">&lt;nothin&gt;</span>' to do with my selection
 [85] │ My <span style="color:#008080">&lt;anaconda&gt;</span> don't want none
 [88] │ But please don't lose <span style="color:#008080">&lt;that&gt;</span> butt
 [89] │ Some brothers wanna play <span style="color:#008080">&lt;that&gt;</span> hard role
 [90] │ And tell you <span style="color:#008080">&lt;that&gt;</span> the butt ain't gold
 [93] │ So Cosmo <span style="color:#008080">&lt;says&gt;</span> you're fat
 [94] │ Well I ain't down with <span style="color:#008080">&lt;that&gt;</span>
[108] │ And <span style="color:#008080">&lt;kick&gt;</span> them nasty thoughts
</pre>
</div>
<p>Victory! Those nasty thoughts have indeed been kicked.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="babygotback1.jpg" class="img-fluid figure-img"></p>
<figcaption>When the backreference actually works</figcaption>
</figure>
</div>
</section>
<section id="lookaheadlookbehind" class="level2">
<h2 class="anchored" data-anchor-id="lookaheadlookbehind">Lookahead/lookbehind</h2>
<p>Continuing with the all-important task of matching patterns in the immortal words of Sir Mix-a-Lot, it’s time to talk about <strong>lookahead</strong> and <strong>lookbehind</strong>. Suppose I want to find words that begin and end with the letter <code>"a"</code>, but I don’t actually want to include the letter <code>a</code> at the end. In other words, I need to “look ahead” to check if the <code>d</code> in <code>anaconda</code> is followed by an <code>a\b</code> (i.e., <code>a</code> at the end of the word), but not include the <code>a\b</code> in the match. We can do this by creating a special “lookahead group” that encloses the <code>a\b</code>. However, instead of writing <code>(a\b)</code> like we would for a capturing group, we use <code>(?=</code> at the start to indicate that it’s a lookahead group. In other words, a lookahead group that detects (but does not match) the <code>a</code> at the end of <code>anaconda</code> is <code>(?=a\b)</code>, and the full regex is <code>\ba\w+(?=a\b)</code>. Here’s what that looks like when we put it into practice:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(babygotback, <span class="st">"</span><span class="sc">\\</span><span class="st">ba</span><span class="sc">\\</span><span class="st">w+(?=a</span><span class="sc">\\</span><span class="st">b)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[85] │ My <span style="color:#008080">&lt;anacond&gt;</span>a don't want none
</pre>
</div>
<p>By analogy to lookahead groups, regular expressions also support lookbehind groups. They’re exactly the same concept as a lookahead group, but this time we’re looking at the text <em>preceding</em> the match rather than the text <em>following</em> it. The syntax for a lookbehind group is very similar, but we open the group with <code>(?&lt;=</code> to specify that it’s lookbehind not lookahead. So, for instance, if we want to detect but not match the first <code>a</code> in <code>anaconda</code>, we use <code>(?=a\b)</code> to do so. The full regex to exclude both terminal <code>a</code> characters is therefore <code>(?&lt;=\ba)\w+(?=a\b)</code> and we end up with this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(babygotback, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">ba)</span><span class="sc">\\</span><span class="st">w+(?=a</span><span class="sc">\\</span><span class="st">b)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[85] │ My a<span style="color:#008080">&lt;nacond&gt;</span>a don't want none
</pre>
</div>
<p>A slightly more realistic example would be to detect all the text inside a parenthetical, but not including the parentheses themselves. We can do this with a completely unintelligible regex like <code>(?&lt;=\()[^)]+(?=\))</code>. It’s a crime against humanity, but it works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(babygotback, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">()[^)]+(?=</span><span class="sc">\\</span><span class="st">))"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[21] │ But that butt you got makes (<span style="color:#008080">&lt;Me-me so horny&gt;</span>)
[30] │ So, fellas (<span style="color:#008080">&lt;Yeah&gt;</span>), Fellas (<span style="color:#008080">&lt;Yeah&gt;</span>)
[31] │ Has your girlfriend got the butt? (<span style="color:#008080">&lt;Hell yeah&gt;</span>)
[32] │ Tell 'em to shake it (<span style="color:#008080">&lt;Shake it&gt;</span>) Shake it (<span style="color:#008080">&lt;Shake it&gt;</span>)
[36] │ (<span style="color:#008080">&lt;L.A. face with a Oakland booty&gt;</span>)
[38] │ (<span style="color:#008080">&lt;L.A. face with a Oakland booty&gt;</span>)
[39] │ (<span style="color:#008080">&lt;L.A. face with a Oakland booty&gt;</span>)
[60] │ But I gotta be straight when I say I wanna— (<span style="color:#008080">&lt;Uh&gt;</span>)
[68] │ So, ladies (<span style="color:#008080">&lt;Yeah&gt;</span>), Ladies (<span style="color:#008080">&lt;Yeah&gt;</span>)
[69] │ If you wanna roll in my Mercedes (<span style="color:#008080">&lt;Yeah&gt;</span>)
</pre>
</div>
<p>Awesome.</p>
<p>Oh… by the way? This trick works in tidyverse, but it won’t work in base R unless you set <code>perl = TRUE</code>, because the default regular expression engine in base R doesn’t support lookahead and lookbehind groups.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Which seems like a good time to discuss…</p>
</section>
<section id="three-regex-flavours" class="level2">
<h2 class="anchored" data-anchor-id="three-regex-flavours">Three regex flavours</h2>
<p>A persistent headache I have when writing regular expressions, besides the fact that they suck, is that there are so many slight variations on the same idea. At <a href="https://regular-expressions.info">regular-expressions.info</a>, for instance, you can find quick lookup tables for a wide variety of different regular expression engines. It lists <a href="https://www.regular-expressions.info/rlanguage.html">regular expressions in R</a> as one of those systems, but it’s important to remember that this refers to the syntax used by base R tools like <code>grep()</code>, <code>gsub()</code>, <code>gregexpr()</code> and so on. Or, more precisely, it refers to the default POSIX standard for extended regular expressions (ERE). Base R actually supports two different engines, so if you set <code>perl = TRUE</code> when calling base R functions then you would need to look at the <a href="https://www.regular-expressions.info/pcre.html">rules for PCRE</a> (perl compatible regular expressions). In tidyverse, regular expressions are usually handled with the <a href="https://stringr.tidyverse.org/">stringr</a> package that is built on top of <a href="https://stringi.gagolewski.com/">stringi</a>, which in turn uses the <a href="https://icu.unicode.org/">ICU</a> engine that conforms to Unicode standards and as such provides comprehensive Unicode support. The <a href="https://stringi.gagolewski.com/weave/regular_expressions.html">stringi regular expressions</a> page has a nice discussion.</p>
<p>Like an idiot, I forget this on a semi-regular basis, and I try to debug something by looking up the wrong regex syntax and yes, this sometimes matters. For example, when I discussed pre-specified character classes like digits (<code>\d</code>) and word characters (<code>\w</code>), or character ranges like <code>[0-9]</code> and <code>[a-z]</code>, I made a deliberate decision not to discuss the predefined POSIX classes. These include things like <code>[[:alpha:]]</code> that matches alphabetic characters, and <code>[[:digit:]]</code> matches numeric digits. The digit and alphabetic character classes are fairly unproblematic, but there’s also a <code>[[:punct:]]</code> class that is intended to match punctuation characters. I find myself very tempted to use this class because, honestly, who wants to be bothered listing all the punctuation characters by hand? However, it’s a <em>very</em> bad idea to do this because not only do the results depend on system locale (which is to be expected for anything that involves text), there is absolutely no consistency at all in how this class is implemented in different regex engines.</p>
<p>To illustrate this I’ll use an example that I have shamelessly stolen directly from the <a href="https://stringi.gagolewski.com/weave/regular_expressions.html#avoiding-posix-classes">stringi documentation</a>. But first, because I cannot even with the base R regular expression syntax,<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> I’ll define a <code>base_extract_all()</code> function that is roughly analogous to <code>stringr::str_extract_all()</code>, but uses the base R functions to do the work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>base_extract_all <span class="ot">&lt;-</span> <span class="cf">function</span>(string, pattern, <span class="at">perl =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  matches <span class="ot">&lt;-</span> <span class="fu">gregexpr</span>(<span class="at">pattern =</span> pattern, <span class="at">text =</span> string, <span class="at">perl =</span> perl)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">regmatches</span>(<span class="at">x =</span> string, <span class="at">m =</span> matches)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next I’ll define a string <code>punct</code>, which contains an assortment of different characters that one might be inclined to call “punctuation”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>punct <span class="ot">&lt;-</span> <span class="st">",./|</span><span class="sc">\\</span><span class="st">&gt;&lt;?;:'</span><span class="sc">\"</span><span class="st">[]{}-=_+()*&amp;^%$€#@!`~×‒„”"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, what happens when we match <code>punct</code> to <code>"[[:punct:]]"</code>? Well, it depends heavily on which engine you’re using. If you’re using ERE (i.e., base R with <code>perl = FALSE</code>), you get this as the result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>punct <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">base_extract_all</span>(<span class="st">"[[:punct:]]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>, . / | \ &gt; &lt; ? ; : ' " [ ] { } - = _ + ( ) * &amp; ^ % $ € # @ ! ` ~ × ‒ „ ”
</pre>
</div>
<p>What about PCRE? Let’s set <code>perl = TRUE</code> and have a look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>punct <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">base_extract_all</span>(<span class="st">"[[:punct:]]"</span>, <span class="at">perl =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>, . / | \ &gt; &lt; ? ; : ' " [ ] { } - = _ + ( ) * &amp; ^ % $ # @ ! ` ~
</pre>
</div>
<p>Okay yeah that is not even close to being the same thing. But what about the ICU engine? If you’re working in tidyverse, internally you’re probably relying on this engine and, well…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>punct <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract_all</span>(<span class="st">"[[:punct:]]"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>, . / \ ? ; : ' " [ ] { } - _ ( ) * &amp; % # @ ! ‒ „ ”
</pre>
</div>
<p>Le sigh. Of course. Totally different again.</p>
<p>Little discrepancies like this are the reason why at various different points in the text, I’ve had to pause and mention things that work differently across the three regex engines used in R. While the differences between the engines are not large, it only takes one tiny difference to mess up an otherwise perfectly crafted regex. Something that looks like it works when you use <code>stringr::str_detect()</code> will suddenly break when you use the same regex in <code>grep()</code>.</p>
<p>It is annoying.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="threerings.jpg" class="img-fluid figure-img"></p>
<figcaption>Three rings for the regex kings, under th.. okay yeah that’s a bit of a reach</figcaption>
</figure>
</div>
</section>
<section id="backslashes-part-ii" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="backslashes-part-ii">Backslashes (part II)</h2>
<p>We are getting very close to the end of the post (I promise!), but before I wrap up I want to return to the vexed topic of using the backslash to escape special characters. I talked about this at the beginning of the post, yes, but at that stage we hadn’t dived very deep into regular expressions. Since then we’ve covered a lot more territory, and in the process we’ve encountered more special characters and more syntax. With that in mind, I’ll revisit that subject now and provide a more comprehensive discussion. Additionally, because – as I’ve hinted – the rules <em>inside</em> a character set are different to the rules that apply <em>outside</em> a character set, I’ll handle those two cases separately.</p>
<section id="special-characters-outside-a-character-set" class="level3">
<h3 class="anchored" data-anchor-id="special-characters-outside-a-character-set">Special characters outside a character set</h3>
<p>Outside of a character set, the characters <code>+</code>, <code>.</code>, <code>?</code>, <code>*</code>, and must all be escaped because otherwise they will be interpreted as quantifiers:</p>
<ul>
<li>write <code>"\\+"</code> in R to mean <code>\+</code> in the regex, and match a literal <code>+</code></li>
<li>write <code>"\\?"</code> in R to mean <code>\?</code> in the regex, and match a literal <code>?</code></li>
<li>write <code>"\\*"</code> in R to mean <code>\*</code> in the regex, and match a literal <code>*</code></li>
</ul>
<p>It obviously follows that since <code>\</code> is used as the escape character it too must be escaped if you want to treat it as a literal. Moreover, since we’ve used <code>|</code> to represent the “or” operator and <code>.</code> to represent the “any” character, you will not be at all surprised to learn that these also must be escaped if you want to represent them as literal characters:</p>
<ul>
<li>write <code>"\\\\"</code> in R to mean <code>\\</code> in the regex, and match a literal <code>\</code></li>
<li>write <code>"\\|"</code> in R to mean <code>\|</code> in the regex, and match a literal <code>|</code></li>
<li>write <code>"\\."</code> in R to mean <code>\.</code> in the regex, and match a literal <code>.</code></li>
</ul>
<p>To help make this concrete, here’s a minimal example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">+"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">*"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">?"</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"+ . ? * </span><span class="sc">\\</span><span class="st"> |"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ <span style="color:#008080">&lt;+&gt;</span> . ? * \ |
[1] │ + . ? <span style="color:#008080">&lt;*&gt;</span> \ |
[1] │ + . <span style="color:#008080">&lt;?&gt;</span> * \ |
[1] │ + . ? * <span style="color:#008080">&lt;\&gt;</span> |
[1] │ + . ? * \ <span style="color:#008080">&lt;|&gt;</span>
[1] │ + <span style="color:#008080">&lt;.&gt;</span> ? * \ |
</pre>
</div>
<p>The same logic applies to special characters like <code>\n</code> (line feed) and <code>\t</code> (tab), as well as regular expressions like <code>\b</code> (boundary), <code>\w</code> (word character), and <code>\s</code> (whitespace). This also applies to <code>\u</code>, if we wish to specify a unicode character in the regex. For these characters we need to escape the <code>\</code> in R, in order to match the corresponding literal in the regex:</p>
<ul>
<li>write <code>"\\n"</code> in R to mean <code>\n</code> in the regex, and match a line feed</li>
<li>write <code>"\\t"</code> in R to mean <code>\t</code> in the regex, and match a tab</li>
<li>write <code>"\\u2300"</code> in R to mean <code>\u2300</code> in the regex, and match a literal <code>⌀</code></li>
<li>write <code>"\\b"</code> in R to mean <code>\b</code> in the regex, and match a word boundary</li>
<li>write <code>"\\w"</code> in R to mean <code>\w</code> in the regex, and match a word character</li>
<li>write <code>"\\s"</code> in R to mean <code>\s</code> in the regex, and match a whitespace character</li>
</ul>
<p>It also applies for the anchor characters <code>^</code> and <code>$</code>:</p>
<ul>
<li>write <code>"\\^"</code> in R to mean <code>\^</code> in the regex, and match a literal <code>^</code></li>
<li>write <code>"\\$"</code> in R to mean <code>\$</code> in the regex, and match a literal <code>$</code></li>
</ul>
<p>On top of this, we have several other characters that need to be escaped within the regex, because brackets, braces, and parentheses have syntactic meaning. However, the rules here are subtle. For the <em>opening</em> brace/bracket/parenthesis, you always have to escape:</p>
<ul>
<li>write <code>"\\["</code> in R to mean <code>\[</code> in the regex and match a literal <code>[</code></li>
<li>write <code>"\\("</code> in R to mean <code>\(</code> in the regex and match a literal <code>(</code></li>
<li>write <code>"\\{"</code> in R to mean <code>\{</code> in the regex and match a literal <code>{</code></li>
</ul>
<p>But for <em>closing</em>, the story is different. Specifically, you don’t have to escape the closing bracket <code>]</code>:</p>
<ul>
<li>write <code>"]"</code> in R to mean <code>]</code> in the regex and match a literal <code>]</code></li>
<li>write <code>"\\)"</code> in R to mean <code>\)</code> in the regex and match a literal <code>)</code></li>
<li>write <code>"\\}"</code> in R to mean <code>\}</code> in the regex and match a literal <code>}</code></li>
</ul>
<p>To make this a little clearer, this is how you do it for the opening bracket/parenthesis/brace:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">["</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">{"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ <span style="color:#008080">&lt;[&gt;</span>blah] (blah) {blah}
[1] │ [blah] <span style="color:#008080">&lt;(&gt;</span>blah) {blah}
[1] │ [blah] (blah) <span style="color:#008080">&lt;{&gt;</span>blah}
</pre>
</div>
<p>This is how you do it for the closing ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"]"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">)"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> <span class="st">"[blah] (blah) {blah}"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[1] │ [blah<span style="color:#008080">&lt;]&gt;</span> (blah) {blah}
[1] │ [blah] (blah<span style="color:#008080">&lt;)&gt;</span> {blah}
[1] │ [blah] (blah) {blah<span style="color:#008080">&lt;}&gt;</span>
</pre>
</div>
</section>
<section id="special-characters-inside-a-character-set" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="special-characters-inside-a-character-set">Special characters inside a character set</h3>
<p>Inside a character set (i.e., within a square bracketed expression), the rules are different and inconsistent across regex flavours. For tidyverse (ICU engine) and base R with <code>perl = TRUE</code> (PCRE engine), there are four special characters you need to worry about: <code>]</code>, <code>^</code>, <code>\</code>, and <code>-</code>. Everything else can be added to a character set without needing any form of escaping. Here’s an example where the character set is comprised of various characters that would normally need to be escaped, but don’t need to be escaped inside a character set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>chars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"+"</span>, <span class="st">"."</span>, <span class="st">"?"</span>, <span class="st">"*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">"</span>, <span class="st">"|"</span>, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"("</span>, <span class="st">")"</span>, <span class="st">"["</span>, <span class="st">"]"</span>, <span class="st">"{"</span>, <span class="st">"}"</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"^"</span>, <span class="st">"$"</span>, <span class="st">"-"</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(chars, <span class="st">"[a+.?*$|(){}]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [1] │ <span style="color:#008080">&lt;+&gt;</span>
 [2] │ <span style="color:#008080">&lt;.&gt;</span>
 [3] │ <span style="color:#008080">&lt;?&gt;</span>
 [4] │ <span style="color:#008080">&lt;*&gt;</span>
 [6] │ <span style="color:#008080">&lt;|&gt;</span>
 [7] │ <span style="color:#008080">&lt;(&gt;</span>
 [8] │ <span style="color:#008080">&lt;)&gt;</span>
[11] │ <span style="color:#008080">&lt;{&gt;</span>
[12] │ <span style="color:#008080">&lt;}&gt;</span>
[14] │ <span style="color:#008080">&lt;$&gt;</span>
</pre>
</div>
<p>Here’s an example where each of the other four special characters <em>are</em> escaped. For the sake of my sanity I’ll include spaces in the character set. This allows me to write it like this, <code>[ \] \^ \\ \- ]</code>, and when specified as an R string it looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(chars, <span class="st">"[ </span><span class="sc">\\</span><span class="st">] </span><span class="sc">\\\\</span><span class="st"> </span><span class="sc">\\</span><span class="st">^ </span><span class="sc">\\</span><span class="st">- ]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre> [5] │ <span style="color:#008080">&lt;\&gt;</span>
[10] │ <span style="color:#008080">&lt;]&gt;</span>
[13] │ <span style="color:#008080">&lt;^&gt;</span>
[15] │ <span style="color:#008080">&lt;-&gt;</span>
</pre>
</div>
<p>In addition to this, there are a few other handy tricks you can use to make the character set simpler:</p>
<ul>
<li>if an unescaped <code>]</code> appears as the first element of the character set, it is a literal</li>
<li>if an unescaped <code>^</code> appears in anything other than the first element, it is also a literal</li>
<li>if an unescaped <code>-</code> appears as the first or last element, it is a literal:</li>
</ul>
<p>So this actually works for detecting right brackets, carets, and hyphens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(chars, <span class="st">"[]^-]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>[10] │ <span style="color:#008080">&lt;]&gt;</span>
[13] │ <span style="color:#008080">&lt;^&gt;</span>
[15] │ <span style="color:#008080">&lt;-&gt;</span>
</pre>
</div>
<p>In all these examples I’m using <code>str_view()</code>, so we’re using the “tidyverse style” regular expressions here based on the ICU engine. If we switch over to base R and set <code>perl = TRUE</code> (and hence use the PCRE engine), the results would be the same. However, the rules for the POSIX ERE engine are slightly different. If you’re using base R with the default <code>perl = FALSE</code> setting, the only character that you can escape within a character set is the backslash itself, so if you want to match <code>]</code>, <code>^</code>, or <code>-</code> then you have to rely on the positional tricks shown above. Here’s how you’d do it using the ERE engine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">grep</span>(<span class="st">"[]^</span><span class="sc">\\\\</span><span class="st">-]"</span>, chars, <span class="at">value =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>\ ] ^ -
</pre>
</div>
<p>God this is exhausting.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cats.jpg" class="img-fluid figure-img"></p>
<figcaption>Very much like the show in question, this post is running a little longer than anyone could reasonably have expected</figcaption>
</figure>
</div>
</div></div></section>
</section>
<section id="substitution" class="level2">
<h2 class="anchored" data-anchor-id="substitution">Substitution</h2>
<p>There’s one last topic to talk about: substitution. Throughout the post I’ve focused almost entirely on detecting patterns in text. In base R you might use <code>grep()</code> to accomplish this task, whereas in stringr you’d probably use <code>str_detect()</code>.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> The other main thing I use regular expressions for is making <strong>substitutions</strong>, in which the matched text is replaced by something new. In base R you’d probably use <code>gsub()</code> for this, whereas in stringr you’d most likely use <code>str_replace()</code> or <code>str_replace_all()</code>.</p>
<p>In most cases where I’ve had to use it substitution doesn’t introduce any new concepts: the “replacement” text is usually a fixed string that is inserted wherever a match is found. For example, if I want to replace the word <code>"cat"</code> with the emoji <code>"🐈"</code>, I would do something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">str_replace_all</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="st">"if you concatenate two cats you get a catcat"</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">bcats?</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"🐈"</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>if you concatenate two 🐈 you get a catcat
</pre>
</div>
<p>Okay yes, in this example I had to do a little bit of work in the <code>pattern</code> argument to come up with the regex that I wanted to use to define matches, but the <code>replacement</code> argument is very simple. Nothing new here really.</p>
<p>However, there are some fancy things that you can do with replacement text. In particular, all three regular expression engines used in R support backreferences within the replacement text. Here it is in all three engines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>a_vile_lie <span class="ot">&lt;-</span> <span class="st">"dogs are better than cats"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tidyverse + ICU</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">str_replace_all</span>(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> a_vile_lie,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(dogs)(.*)(cats)"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">3</span><span class="sc">\\</span><span class="st">2</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># base R + ERE</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">gsub</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(dogs)(.*)(cats)"</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">3</span><span class="sc">\\</span><span class="st">2</span><span class="sc">\\</span><span class="st">1"</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> a_vile_lie</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># base R + PCRE</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">gsub</span>(</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(dogs)(.*)(cats)"</span>,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">3</span><span class="sc">\\</span><span class="st">2</span><span class="sc">\\</span><span class="st">1"</span>,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> a_vile_lie,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">perl =</span> <span class="cn">TRUE</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>cats are better than dogs
cats are better than dogs
cats are better than dogs
</pre>
</div>
<p>As an aside, this last example is very closely related to the problem I was trying to solve when I finally broke down and decided to write the post. The thing I actually wanted to do was manipulate text inside parentheses using backreferences in the replacement string, without matching the parentheses themselves. To solve that you need to use backreferences, but you also need to use lookahead and lookbehind functionality:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidyverse + ICU</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">str_replace_all</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="st">"ab(cd)efg[hi]j"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(?&lt;=[</span><span class="sc">\\</span><span class="st">[(])(</span><span class="sc">\\</span><span class="st">w+)(?=[)</span><span class="sc">\\</span><span class="st">]])"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1,</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># base R + PCRE</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">gsub</span>(</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"(?&lt;=[</span><span class="sc">\\</span><span class="st">[(])(</span><span class="sc">\\</span><span class="st">w+)(?=[)</span><span class="sc">\\</span><span class="st">]])"</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1,</span><span class="sc">\\</span><span class="st">1"</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"ab(cd)efg[hi]j"</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">perl =</span> <span class="cn">TRUE</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>ab(cd,cd)efg[hi,hi]j
ab(cd,cd)efg[hi,hi]j
</pre>
</div>
<p>It would be trickier to do this with the ERE engine because it doesn’t support lookahead/lookbehind behaviour, but somehow I was convinced it could be done. I ended up reading far too much and… well, this is where we ended up.</p>
</section>
<section id="im-so-sorry-for-my-loss" class="level2">
<h2 class="anchored" data-anchor-id="im-so-sorry-for-my-loss">I’m so sorry for my loss</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                 <span class="sc">~</span>pattern, <span class="sc">~</span>replacement,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"([Dd]o)(-[Dd]o)+"</span>,         <span class="st">"🎶"</span>, <span class="co"># do-do, do-do-do -&gt; musical note</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"feather"</span>,         <span class="st">"🪶"</span>, <span class="co"># feather -&gt; emoji feather</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"wine"</span>,         <span class="st">"🍷"</span>, <span class="co"># wine -&gt; emoji wine</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">()[Aa]h(?=</span><span class="sc">\\</span><span class="st">))"</span>,         <span class="st">"😌"</span>, <span class="co"># (ah) -&gt; emoji relief</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">"</span><span class="sc">\\</span><span class="st">[([^</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">]]+)</span><span class="sc">\\</span><span class="st">]"</span>,         <span class="st">"🎙️"</span>  <span class="co"># replace square bracketed text</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>str_rewrite <span class="ot">&lt;-</span> <span class="cf">function</span>(string, rules) {</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">reduce2</span>(</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> rules<span class="sc">$</span>pattern, </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.y =</span> rules<span class="sc">$</span>replacement, </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> str_replace_all, </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.init =</span> string</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>feather <span class="sc">|&gt;</span> </span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_rewrite</span>(rules) <span class="sc">|&gt;</span> </span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre>🎙️
(🎶, 🎶, 🎶, 🎶)
(🎶, 🎶, 🎶, 🎶)
Oh, not another take

🎙️
Oh, it's like that, I'm your dream come true
When it's on a platter for you
Then you pull back when I try to make plans
More than two hours in advance, mm

🎙️
I slam the door, I hit ignore
I'm saying, "No, no, no, no more"
I got you blocked, after this, an afterthought
I finally cut you off

🎙️
I feel so much lighter like a 🪶 with you off my mind (😌)
Floatin' through the memories like whatever, you're a waste of time (😌)
Your signals are mixed, you act like a bitch
You fit every stereotype, "Send a pic"
I feel so much lighter like a 🪶 with you out my life
With you out my life

🎙️
(🎶, 🎶, 🎶, 🎶)
(🎶, 🎶, 🎶, 🎶)
Like a 🪶, like a 🪶, like a 🪶, yeah

🎙️
It feels so good
Not carin' where you are tonight
And it feels so good
Not pretendin' to like the 🍷 you like

🎙️
I slam the door (Slam the door), I hit ignore (Hit ignore)
I'm saying, "No, no, no, no more"
I got you blocked, excited to never talk, I
I'm so sorry for your loss

🎙️
I feel so much lighter like a 🪶 with you off my mind (😌)
Floatin' through the memories like whatever, you're a waste of time (😌)
Your signals are mixed, you act like a bitch (A bitch)
You fit every stereotype, "Send a pic"
I feel so much lighter like a 🪶 with you out my life
With you out my life

🎙️
(🎶, 🎶, 🎶, 🎶)
Ah, mm
(🎶, 🎶, 🎶, 🎶)
Like a 🪶, like a 🪶, like a 🪶

🎙️
You want me? I'm done
You miss me? No duh
Where I'm at, I'm up where I'm at
You want me? I'm done (I'm done)
You miss me? No duh (No duh)
Where I'm at, I'm up (I'm up) where I'm at

🎙️
You want me? I'm done
(I feel so much lighter like a 🪶 with you off my mind)
You miss me? No duh
Where I'm at, I'm up where I'm at
(Like a 🪶, like a 🪶, like a 🪶)
You want me? I'm done
(I feel so much lighter like a 🪶 with you off my mind)
You miss me? No duh
Where I'm at, I'm up where I'm at
(Like a 🪶, like a 🪶, like a 🪶, yeah)
</pre>
</div>
<!--



::: {.cell}

```{.r .cell-code}
midnight |> 
  str_replace_all("(JK )?Rowling", "🧛‍♀️") |> 
  str_replace_all("(Jesse )?Singal", "🪱️") |> 
  str_replace_all("(Helen )?Joyce", "🧟‍♀️") |> 
  str_wrap() |> 
  cat(sep = "\n")
```

<pre>[mysterious circle of robed figures]
🧛‍♀️: hello children
🧛‍♀️: what newsss, wormtongue?
🧛‍♀️: how goes the infiltration of bluesssky?
🪱️: mommy mommy
🪱️: it was SO HARD
🪱️: the trans were SO MEAN
🪱️: they all blocked me!
🪱️: i was almost ignored to death!

🧛‍♀️: you poor child
🪱️: but i did it mommy
🪱️: every single person on the site told them to ban me
🪱️: but i'm way more important than any of them!
🪱️: so i can stay!
🧛‍♀️: excellent!
🧛‍♀️: door'sss open, boysss!

🪱️: mommy i fought so hard for you
🧛‍♀️: i know you did, jesssse
🪱️: i did it all for you mommy
🧛‍♀️: yess you did great jessse
🪱️: i asked all those questions just for you mommy
🧛‍♀️: yeah thats great
🪱️: i had all those reasonable concerns just for you mommy

🪱️: mommy mommy the trans were so mean, they said mean things about me on the
internet
🪱️: i don't know how they could do that!
🪱️: they just don't understand how much it hurts to have people say mean things
about you on the internet!
🪱️: they just can't relate!

🪱️: it hurts when people say mean things about me on the internet!
🪱️: the trans don't understand
🪱️: they have their hard reptilian hides to protect them
🪱️: but i'm not a monster like them, i'm a person!
🪱️: i have feelings!

🪱️: mommy they were so mean
🪱️: my feelings are so hurt
🪱️: kiss it and make it better mommy
🧟‍♀️: do we
🧟‍♀️: do we really need to keep this guy around?
🧛‍♀️: patience, ssssisster, we must bide our time
🧟‍♀️: you don't have ANYONE else who could do this?
🪱️: mommy mommy

🧟‍♀️: i mean, we don't have anyone else who could launder transphobia into
respectable liberal discourse?
🧟‍♀️: anyone at all
🧛‍♀️: well i really thought tatsuya ishida was going to be ready for prime time by
now
🧛‍♀️: but we missed that window
🧛‍♀️: now he's overripe

🧛‍♀️: oh helen you don't understand
🧛‍♀️: sure, jessse might look like a sniveling worm, a nasty crawling slithering
little shit, a spineless craven buffoon
🧛‍♀️: but damn if he isn't the best reasonable concern haver in the business

🪱️: mommy mommy they were so mean to me
🪱️: i was unfairly judged, just like a child molester is unfairly judged!
🧛‍♀️:
🧛‍♀️:
🧛‍♀️:
🧛‍♀️:
</pre>
:::



-->


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>At the R console, this highlighting appears automatically. Normally you wouldn’t see this highlighting in a quarto document like this one, because quarto strips out the ANSI control characters that the console uses to add colour to the output. However, for the purposes of this post I cheated a little, by writing a <a href="../../posts/2023-12-30_knitr-hooks/">knitr hook</a> that crudely mimics the same behaviour in this document.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There are a ghastly number of different regular expression flavours out there. They are very similar to each other, but have subtle differences. Somewhat frustratingly, there are <em>three</em> different regular expression flavours that are widely used in R (two in base R and one in tidyverse), and every now and then I find myself running into cases where they don’t produce identical results. More on this later in the post.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I usually imagine the character has a <a href="https://forgottenrealms.fandom.com/wiki/Yuan-ti">yuan-ti</a> thing going on<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I’m not talking about raw strings in this post. Sorry.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Yes I know it’s more nuanced than that, hush, I’ll get to that momentarily.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>There’s also a mechanism for naming groups and name-based referencing, but I never use it.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>That’s another one of those fun things where there are in fact three separate flavours of regex in widespread usage in R. ICU (used by stringi and stringr) and PCRE (base R with <code>perl = TRUE</code>) both support lookahead and lookbehind assertions, as well as negative lookahead <code>(?!blah)</code> and negative lookbehind <code>(?&lt;!blah)</code>, but the ERE engine (base R with <code>perl = FALSE</code>) does not.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>I mean, wtf. I am genuinely sympathetic to R core, and deeply appreciate their willingness to maintain backward compatibility even for the bits of R that are just bizarre. But oh my god.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>I know I know. I’ve mostly used <code>str_view()</code> rather than <code>str_detect()</code> because it’s convenient for visually illustrating the regex match. But you wouldn’t work with this in a script<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{navarro2024,
  author = {Navarro, Danielle},
  title = {Baby Got Backreferences},
  date = {2024-12-16},
  url = {https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-navarro2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Navarro, Danielle. 2024. <span>“Baby Got Backreferences.”</span>
December 16, 2024. <a href="https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/">https://blog.djnavarro.net/posts/2024-12-16_regex-backreferences/</a>.
</div></div></section></div></main> <!-- /main -->
<!-- plausible -->
<script async="" defer="" data-domain="blog.djnavarro.net" src="https://plausible.io/js/plausible.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/blog\.djnavarro\.net");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://blog.djnavarro.net">
<p>blog.djnavarro.net</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>