{
  "hash": "2b3f5c9079d4b1d311ba6d896416aaba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ggplot2-scatterplot-pairs\"\ndescription: \"This is a subtitle\"\ndate: \"2025-06-03\"\n--- \n\n\n\n<!--------------- my typical setup ----------------->\n\n\n\n\n\n\n\n<!--------------- post begins here ----------------->\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairwise_pivot <- function(data, \n                           pivot_cols, \n                           other_cols = !pivot_cols,\n                           names_to = \"name\",\n                           values_to = \"value\",\n                           pair_label = c(\"x\", \"y\"),\n                           pair_label_sep = \"_\",\n                           row_id = \"row_id\") {\n\n    x_value <- paste(pair_label[1], values_to, sep = pair_label_sep)\n    y_value <- paste(pair_label[2], values_to, sep = pair_label_sep)\n    x_name  <- paste(pair_label[1], names_to, sep = pair_label_sep)\n    y_name  <- paste(pair_label[2], names_to, sep = pair_label_sep)\n\n    base <- data |> \n        dplyr::mutate({{row_id}} := dplyr::row_number())\n  \n    fixed_data <- base |> \n        dplyr::select(\n            {{other_cols}}, \n            tidyselect::all_of(row_id)\n        )\n    \n    long_x <- base |>\n        dplyr::select(\n            {{pivot_cols}},            \n            tidyselect::all_of(row_id)\n        ) |>\n        tidyr::pivot_longer(\n            cols = {{pivot_cols}},\n            names_to = {{x_name}},\n            values_to = {{x_value}}\n        )\n\n    long_y <- long_x |> \n        dplyr::rename(\n            {{y_name}} := {{x_name}}, \n            {{y_value}} := {{x_value}}\n        )\n\n    pairs <- dplyr::full_join(\n        x = long_x,\n        y = long_y,\n        by = row_id,\n        relationship = \"many-to-many\"\n    ) |>\n    dplyr::relocate({{y_name}}, .after = {{x_name}}) |>\n    dplyr::left_join(fixed_data, by = row_id)\n    \n    pairs\n}\n\npenguin_paired_measurements <- penguins |>\n    tibble::as_tibble() |>\n    pairwise_pivot(\n        pivot_cols = bill_len:body_mass,\n        other_cols = species,\n        row_id = \"penguin\",\n        names_to = \"var\",\n        values_to = \"val\"\n    )\n\npenguin_paired_measurements\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5,504 × 6\n   penguin x_var       y_var       x_val  y_val species\n     <int> <chr>       <chr>       <dbl>  <dbl> <fct>  \n 1       1 bill_len    bill_len     39.1   39.1 Adelie \n 2       1 bill_len    bill_dep     39.1   18.7 Adelie \n 3       1 bill_len    flipper_len  39.1  181   Adelie \n 4       1 bill_len    body_mass    39.1 3750   Adelie \n 5       1 bill_dep    bill_len     18.7   39.1 Adelie \n 6       1 bill_dep    bill_dep     18.7   18.7 Adelie \n 7       1 bill_dep    flipper_len  18.7  181   Adelie \n 8       1 bill_dep    body_mass    18.7 3750   Adelie \n 9       1 flipper_len bill_len    181     39.1 Adelie \n10       1 flipper_len bill_dep    181     18.7 Adelie \n# ℹ 5,494 more rows\n```\n\n\n:::\n:::\n\n\n\nPlot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot <- function(data) {\n    data |>\n        ggplot2::ggplot(ggplot2::aes(\n            x = x_val, \n            y = y_val,\n            colour = species\n        )) +\n        ggplot2::geom_point() +\n        ggplot2::theme_bw() +\n        ggplot2::labs(\n            x = NULL,\n            y = NULL\n        )\n}\n\n\npenguin_paired_measurements |>\n    base_plot() +\n    ggplot2::facet_grid(y_var ~ x_var, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/paired-plot-all-facets-1.png){width=672}\n:::\n:::\n\n\n\nPlot after filtering identity cases:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_paired_measurements |>\n    dplyr::filter(y_var != x_var) |>\n    base_plot() +\n    ggh4x::facet_grid2(\n        y_var ~ x_var,\n        scales = \"free\",\n        render_empty = FALSE\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/paired-plot-drop-diagonal-1.png){width=672}\n:::\n:::\n\n\n\n\nPlot after filtering to upper triangular cases:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_paired_measurements |>\n    dplyr::filter(x_var > y_var) |>\n    base_plot() +\n    ggh4x::facet_grid2(\n        y_var ~ x_var,\n        scales = \"free\",\n        render_empty = FALSE\n    ) + \n    ggplot2::scale_x_continuous(position = \"top\") + \n    ggplot2::scale_y_continuous(position = \"right\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/paired-plot-upper-triangular-1.png){width=672}\n:::\n:::\n\n\n\n\nPlot after filtering to lower triangular cases:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_paired_measurements |>\n    dplyr::filter(y_var > x_var) |>\n    base_plot() +\n    ggh4x::facet_grid2(\n        y_var ~ x_var,\n        scales = \"free\",\n        switch = \"both\",\n        render_empty = FALSE\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/paired-plot-lower-triangular-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}