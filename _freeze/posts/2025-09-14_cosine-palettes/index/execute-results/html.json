{
  "hash": "75b243f58dd9227efe8b0ce9101b790b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Linear cosine palettes\"\ndescription: \"Kind of a generative art thing, but mostly an attempt by the author to prove to herself that a she can write a short blog post without turning it into a goddamn monograph\"\ndate: \"2025-09-14\"\ncategories: [\"Art\", \"R\"]\nimage: cover.png\nimage-alt: Rectangle themed art with a subdued palette\nknitr:\n  opts_chunk: \n    dev.args:\n      bg: \"#00000000\"\n--- \n\n\n\n<!--------------- my typical setup ----------------->\n\n\n\n\n\n\n\n<!--------------- post begins here ----------------->\n\nSo. Looking back at my history on this blog I have noticed that I, ummmmmm, tend to write long posts. It is a character flaw of which I am acutely aware. When I want to understand a thing I feel a kind of psychological compulsion to delve too deeply into the darkness, dive into to as many of the specifics as I possibly can, organise my thoughts around those specifics, and then drag the whole cursed mess into the daylight so that my long-suffering readers can look on in horror at the grotesquerie of my inner world. \n\nI am aware that this is perhaps unwise.\n\nReflecting on this as a personal weakness, I have set myself a challenge this fine Sunday: is it even possible for me to write a simple blog post? Like, is it even possible for a mediocre bitch to write a short goddamn article without turning it into some macabre monograph? Given my past form, it is not at all obvious that I'm capable of this level of self-restraint. Let's see if I can do it?\n\n## Linear cosine palettes \n\nThe motivation came from this [mastodon post](https://fosstodon.org/@coolbutuseless/115173701685084866) by Mike Cheng proposing a simple method for randomly generating continuous colour palettes in R. The original idea comes from a blog post by Inigo Quilez on [simple procedural palettes](https://iquilezles.org/articles/palettes/), and the idea is painfully simple. Let's say we have length-3 vectors $\\mathbf{a}$, $\\mathbf{b}$, $\\mathbf{c}$, and $\\mathbf{d}$ representing four \"base\" colours from which a continous palette is to be generated. In R we could choose these base colours using the `colors()` function. Once these are selected we can define a smooth palette using the following function\n\n$$\nf(t) = \\mathbf{a} + \\mathbf{b} \\ \\cos(2 \\pi(\\mathbf{c} t + \\mathbf{d}))\n$$\n\nwhere $t$ is varied from 0 to 1. The nice thing about this paletting rule is that it can be very fast, especially since -- I am told by people who understand such things -- there are a *lot* of optimisations in modern CPUs and GPUs to make cosine evaluation fast. Admittedly, speed is not something I care about much in my generative art work because palette generation is not even close to being a bottleneck in my code and also I'm lazy. \n\nOkay, so here's an R function that implements a very minor tweak on Mike's implementation of Inigo Quilez' cosine palettes:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncosine_palette <- function(n, base = NULL, seed = NULL) {\n  if (!is.null(seed)) set.seed(seed)\n  if (is.null(base)) base <- colors(distinct = TRUE)\n  a <- c(0.5, 0.5, 0.5)\n  b <- (sample(base, 1) |> col2rgb() |> as.vector()) / 255\n  c <- (sample(base, 1) |> col2rgb() |> as.vector()) / 255\n  d <- (sample(base, 1) |> col2rgb() |> as.vector()) / 255\n  pal <- vapply(\n    seq(0, 1, length.out = n), \n    function(t) a + b * cos(2 * pi * (c * t + d)), \n    double(3)\n  )\n  pal[pal > 1] <- 1\n  rgb(t(abs(pal)))\n}\n\ncosine_palette(n = 16, seed = 11)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"#7F1616\" \"#6F1A17\" \"#362A20\" \"#22442F\" \"#8A6642\" \"#F18A5A\" \"#FFAD74\"\n [8] \"#FFCB8F\" \"#FFE0A9\" \"#FFE9C0\" \"#FFE6D3\" \"#AAD6E1\" \"#40BDE8\" \"#1F9CE9\"\n[15] \"#6377E3\" \"#7F54D6\"\n```\n\n\n:::\n:::\n\n\n\nThat's nice, but as my visual cortex is not optimised for the interpretation of hexadecimal RGB colour codes, I find it convenient to show palettes using... check notes... images? Yes. Yes, that sounds right. To that end I'll use this `shade_strip()` that I sometimes use to display a continuously varying palette as a strip:\n\n\n\n::: {.cell .column-page layout-ncol=\"4\"}\n\n```{.r .cell-code}\nshade_strip <- function(cols) {\n  withr::with_par(\n    list(mar = c(0,0,0,0)),\n    image( matrix(seq_along(cols), ncol = 1), col = cols, axes = FALSE)\n  )\n}\n\nseeds <- 11:22\nseeds |> \n  purrr::map(\\(s) cosine_palette(n = 256, seed = s)) |> \n  purrr::walk(shade_strip)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-1.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-2.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-3.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-4.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-5.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-6.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-7.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-8.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-9.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-10.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-11.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/palette-examples-12.png){width=768}\n:::\n:::\n\n\n\nI wanted to get a sense of how well these palettes might behave if applied in a generative art system, so I chose 12 sequential seeds. The sequence starts at `seed = 11` because I happened to like the first piece that was generated using that palette, but apart from that minor intervention I haven't tried to \"hack\" the seed to bias the outputs. \n\n## Application to generative art \n\nTo get a feel for how these palettes behave when used in generative art, here are some pieces created using them. These pieces are created using the `subdivision()` system that I wrote about as part of the [art from code](/posts/2024-12-23_art-from-code-6/) workshop I gave a few years ago.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code for subdivision()\"}\nchoose_rectangle <- function(blocks) {\n  sample(nrow(blocks), 1, prob = blocks$area)\n}\n\nchoose_break <- function(lower, upper) {\n  round((upper - lower) * runif(1))\n}\n\ncreate_rectangles <- function(left, right, bottom, top, value) {\n  tibble::tibble(\n    left = left,\n    right = right,\n    bottom = bottom,\n    top = top,\n    width = right - left,\n    height = top - bottom,\n    area = width * height,\n    value = value\n  )\n}\n\nsplit_rectangle_x <- function(rectangle, new_value) {\n  with(rectangle, {\n    split <- choose_break(left, right)\n    new_left  <- c(left, left + split)\n    new_right <- c(left + split, right)\n    new_value <- c(value, new_value)\n    create_rectangles(new_left, new_right, bottom, top, new_value)\n  })\n}\n\nsplit_rectangle_y <- function(rectangle, new_value) {\n  with(rectangle, {\n    split <- choose_break(bottom, top)\n    new_bottom <- c(bottom, bottom + split)\n    new_top <- c(bottom + split, top)\n    new_value <- c(value, new_value)\n    create_rectangles(left, right, new_bottom, new_top, new_value)\n  })\n}\n\nsplit_rectangle <- function(rectangle, value) {\n  split_fn <- ifelse(runif(1) < .5, split_rectangle_x, split_rectangle_y)\n  split_fn(rectangle, value)\n}\n\nsplit_block <- function(blocks, value) {\n  old <- choose_rectangle(blocks) \n  new <- split_rectangle(blocks[old, ], value)\n  dplyr::bind_rows(blocks[-old, ], new)\n}\n\nsubdivision <- function(ncol = 100, \n                        nrow = 100, \n                        nsplits = 256,\n                        border = NULL, \n                        seed = NULL) {\n  \n  if (!is.null(seed)) set.seed(seed)\n\n  pal <- cosine_palette(n = 256, seed = seed)\n\n  if (is.null(border)) border <- pal[128]\n\n  rct <- create_rectangles(\n    left = 1, \n    right = ncol, \n    bottom = 1, \n    top = nrow, \n    value = 0\n  )\n\n  div <- purrr::reduce(\n    1:nsplits, \n    split_block, \n    .init = rct\n  )\n\n  plt <- div |> \n    ggplot2::ggplot(ggplot2::aes(\n      xmin = left, \n      xmax = right, \n      ymin = bottom, \n      ymax = top,\n      fill = value\n    )) +\n    ggplot2::geom_rect(\n      show.legend = FALSE, \n      color = border,\n      linewidth = 1\n    ) +\n    ggplot2::scale_fill_gradientn(colours = pal) +\n    ggplot2::scale_x_continuous(expand = ggplot2::expansion(mult = .15)) + \n    ggplot2::scale_y_continuous(expand = ggplot2::expansion(mult = .15)) + \n    ggplot2::coord_equal() +\n    ggplot2::theme_void() +\n    ggplot2::theme(plot.background = ggplot2::element_rect(\n      color = border,\n      fill = border\n    ))\n\n  plt\n}\n```\n:::\n\n::: {.cell .column-page layout-ncol=\"4\"}\n\n```{.r .cell-code}\nseeds |> purrr::walk(\\(s) plot(subdivision(seed = s)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-1.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-2.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-3.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-4.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-5.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-6.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-7.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-8.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-9.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-10.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-11.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/subdivision-examples-12.png){width=768}\n:::\n:::\n\n\n\nNot too bad at all. Some of the pieces are pretty awful, a few of them are lovely, and most are okay. Given that I've made no attempt at all to optimise the way that palette aligns with the structure of the pieces, that's not a bad outcome at all. \n\nAs a second example, here's a series of pieces based on the [lissajous](https://art.djnavarro.net/gallery/lissajous/) system, all using the same palettes:\n\n\n\n::: {.cell .column-page layout-ncol=\"4\"}\n\n```{.r .cell-code}\nseeds |> purrr::walk(\\(s) lissajous(seed = s))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-1.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-2.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-3.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-4.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-5.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-6.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-7.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-8.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-9.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-10.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-11.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/lissajous-examples-12.png){width=768}\n:::\n:::\n\n\n\nAlso pretty tolerable. In any specific application I'd probably want to tinker a bit and adapt to the specific aesthetic that the system is targeting, but I'm not displeased at all. For something so simple it works better than I expected. Okay, all good. We're done now. Post completed, nothing else to add. Somehow I have managed to write a *short* blog post without turning it into a computational novella, and the whole exercise only took a few hours from beginning to end. ðŸŽ‰",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}