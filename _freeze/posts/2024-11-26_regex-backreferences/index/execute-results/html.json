{
  "hash": "7c34071562148b1494dbbdfb326a66b1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Baby got back references\"\ndescription: \"Now I have \\\\\\\\2 problems\"\ndate: \"2024-11-26\"\nimage: \"feather2.jpg\"\n--- \n\n\n\n<!--------------- my typical setup ----------------->\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n<style type=\"text/css\">\n@import url('https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap');\n\n.tangerine-regular {\n  font-family: \"Tangerine\", cursive;\n  font-weight: 400;\n  font-style: normal;\n}\n\n.tangerine-bold {\n  font-family: \"Tangerine\", cursive;\n  font-weight: 700;\n  font-style: normal;\n}\n</style>\n:::\n\n\n\n<!--------------- post begins here ----------------->\n\nAt least once a week I have this moment when a yawning pit of black despair opens at my feet, and the barbed tentacles of despair wrap around my legs, poison injects chill into my veins, the icy claws of anxiety rip through my viscera, and a withered voice of pure evil slithers into my brain and speaks to me in the disturbingly-seductive language of Mordor:\n\n<p class=\"tangerine-bold\" align=\"center\" style=\"font-size: 28pt\">why not write a regular expression?</p>\n\nI try to resist. I'm a good girl, I tell the Dark Lord. I would never. Not on a first date anyway. Well, buy a girl a drink first maybe? And... oh it's so cold outside and honestly Sauron is kinda hot. Have you not watched Rings of Power? Sometimes a girl has needs.\n\nUm. Anyway. What was I talking about?\n\n<br>\n\n\n::: {layout-ncol=2}\n\n![When I try to write a regular expression](feather1.jpg)\n\n![When the regular expression encounters a string](feather2.jpg)\n\n:::\n\n\n## Oh no not another take\n\nA persistent headache I have when writing regular expressions, besides the fact that they suck, is that there are so many slight variations on the same idea. At [regular-expressions.info](https://regular-expressions.info), for instance, you can find quick lookup tables for a wide variety of different regular expression engines. It lists [regular expressions in R](https://www.regular-expressions.info/rlanguage.html) as one of those systems, but it's important to remember that this refers to the syntax used by base R tools like `grep()`, `gsub()`, `gregexpr()` and so on. Or, more precisely, it refers to the default POSIX standard for extended regular expressions. Base R actually supports two different engines, so if you set `perl = TRUE` when calling base R functions then you would need to look at the [rules for PCRE](https://www.regular-expressions.info/pcre.html). In tidyverse, regular expressions are usually handled with the [stringr](https://stringr.tidyverse.org/) package that is built on top of [stringi](https://stringi.gagolewski.com/), which in turn uses the [ICU](https://icu.unicode.org/) engine that conforms to Unicode standards and as such provides comprehensive Unicode support. The [stringi regular expressions](https://stringi.gagolewski.com/weave/regular_expressions.html) page has a nice discussion. \n\nLike an idiot, I forget this on a semi-regular basis, and I try to debug something by looking up the wrong regex syntax and yes, this sometimes matters. For instance, in the help documentation for regex in base R, you can find some discussion of various predefined POSIX classes (e.g., `\"[[:alpha:]]\"` matches alphabetic characters, `[[:digit:]]` matches numeric digits, and `\"[[:punct:]]\"` matches punctuation characters). However, different engines interpret these classes differently, which means you'll sometimes get different results depending on which engine you use.^[It also depends on the system locale. Not surprising, of course, but that does add to the sheer chaos of it all.]\n\nTo illustrate this I'll use an example that I have shamelessly stolen directly from the [stringi documentation](https://stringi.gagolewski.com/weave/regular_expressions.html#avoiding-posix-classes), in order to show how very differently `\"[[:punct:]]\"` is interpreted across the three most commonly used regex engines in R. But first, because I cannot even with the base R regular expression syntax,^[I mean, wtf. I am genuinely sympathetic to R core, and deeply appreciate their willingness to maintain backward compatibility even for the bits of R that are just bizarre. But oh my god.] I'll define a `base_extract_all()` function that is roughly analogous to `stringr::str_extract_all()`, but uses the base R functions to do the work:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_extract_all <- function(string, pattern, perl = FALSE) {\n  matches <- gregexpr(pattern = pattern, text = string, perl = perl)\n  regmatches(x = string, m = matches)\n}\n```\n:::\n\n\n\nNext, I'll define a string `punct` containing a lot of punctuation characters:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npunct <- \",./|\\\\<>?;:'\\\"[]{}-=_+()*&^%$â‚¬#@!`~Ã—â€’â€â€\"\n```\n:::\n\n\n\nSo, what happens when we match `punct` to `\"[[:punct:]]\"`? Well, it depends heavily on which engine you're using. If you're using ERE (i.e., base R with `perl = FALSE`), you get this as the result:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_extract_all(punct, \"[[:punct:]]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1] \",\"  \".\"  \"/\"  \"|\"  \"\\\\\" \"<\"  \">\"  \"?\"  \";\"  \":\"  \"'\"  \"\\\"\" \"[\"  \"]\" \n[15] \"{\"  \"}\"  \"-\"  \"=\"  \"_\"  \"+\"  \"(\"  \")\"  \"*\"  \"&\"  \"^\"  \"%\"  \"$\"  \"â‚¬\" \n[29] \"#\"  \"@\"  \"!\"  \"`\"  \"~\"  \"Ã—\"  \"â€’\"  \"â€\"  \"â€\" \n```\n\n\n:::\n:::\n\n\n\nWhat about PCRE? Let's set `perl = TRUE` and have a look:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_extract_all(punct, \"[[:punct:]]\", perl = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1] \",\"  \".\"  \"/\"  \"|\"  \"\\\\\" \"<\"  \">\"  \"?\"  \";\"  \":\"  \"'\"  \"\\\"\" \"[\"  \"]\" \n[15] \"{\"  \"}\"  \"-\"  \"=\"  \"_\"  \"+\"  \"(\"  \")\"  \"*\"  \"&\"  \"^\"  \"%\"  \"$\"  \"#\" \n[29] \"@\"  \"!\"  \"`\"  \"~\" \n```\n\n\n:::\n:::\n\n\n\nOkay yeah that is not even close to being the same thing. But what about the ICU engine? If you're working in tidyverse, internally you're probably relying on this engine and, well...\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstringr::str_extract_all(punct, \"[[:punct:]]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1] \",\"  \".\"  \"/\"  \"\\\\\" \"?\"  \";\"  \":\"  \"'\"  \"\\\"\" \"[\"  \"]\"  \"{\"  \"}\"  \"-\" \n[15] \"_\"  \"(\"  \")\"  \"*\"  \"&\"  \"%\"  \"#\"  \"@\"  \"!\"  \"â€’\"  \"â€\"  \"â€\" \n```\n\n\n:::\n:::\n\n\n\nLe sigh. Of course. \n\n## I'm so sorry for my loss\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfeather <- tibble::tibble(original = brio::read_lines(\"feather.txt\"))\n\nrules <- tibble::tribble(\n              ~pattern, ~replacement,\n    \"([Dd]o)(-[Dd]o)+\",         \"ğŸ¶\", # do-do, do-do-do -> musical note\n             \"feather\",         \"ğŸª¶\", # feather -> emoji feather\n                \"wine\",         \"ğŸ·\", # wine -> emoji wine\n         \"\\\\([Aa]h\\\\)\",      \"...ğŸ˜Œ\", # (ah) -> ...emoji relief\n  \"\\\\[([^\\\\[\\\\]]+)\\\\]\",          \"~\"  # replace square bracketed text\n)\n\nstr_rewrite <- function(string, rules) {\n  purrr::reduce2(\n    .x = rules$pattern, \n    .y = rules$replacement, \n    .f = stringr::str_replace_all, \n    .init = string\n  )\n}\n\nfeather$updated <- str_rewrite(feather$original, rules)\nfeather\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 75 Ã— 2\n   original                                       updated                   \n   <chr>                                          <chr>                     \n 1 \"[Intro]\"                                      \"~\"                       \n 2 \"(Do-do-do, do-do-do, do-do-do, do-do-do)\"     \"(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\"        \n 3 \"(Do-do, do-do-do, do-do-do, do-do-do)\"        \"(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\"        \n 4 \"Oh, not another take\"                         \"Oh, not another take\"    \n 5 \"\"                                             \"\"                        \n 6 \"[Verse 1]\"                                    \"~\"                       \n 7 \"Oh, it's like that, I'm your dream come true\" \"Oh, it's like that, I'm â€¦\n 8 \"When it's on a platter for you\"               \"When it's on a platter fâ€¦\n 9 \"Then you pull back when I try to make plans\"  \"Then you pull back when â€¦\n10 \"More than two hours in advance, mm\"           \"More than two hours in aâ€¦\n# â„¹ 65 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(feather$updated, sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n~\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\nOh, not another take\n\n~\nOh, it's like that, I'm your dream come true\nWhen it's on a platter for you\nThen you pull back when I try to make plans\nMore than two hours in advance, mm\n\n~\nI slam the door, I hit ignore\nI'm saying, \"No, no, no, no more\"\nI got you blocked, after this, an afterthought\nI finally cut you off\n\n~\nI feel so much lighter like a ğŸª¶ with you off my mind ...ğŸ˜Œ\nFloatin' through the memories like whatever, you're a waste of time ...ğŸ˜Œ\nYour signals are mixed, you act like a bitch\nYou fit every stereotype, \"Send a pic\"\nI feel so much lighter like a ğŸª¶ with you out my life\nWith you out my life\n\n~\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\nLike a ğŸª¶, like a ğŸª¶, like a ğŸª¶, yeah\n\n~\nIt feels so good\nNot carin' where you are tonight\nAnd it feels so good\nNot pretendin' to like the ğŸ· you like\n\n~\nI slam the door (Slam the door), I hit ignore (Hit ignore)\nI'm saying, \"No, no, no, no more\"\nI got you blocked, excited to never talk, I\nI'm so sorry for your loss\n\n~\nI feel so much lighter like a ğŸª¶ with you off my mind ...ğŸ˜Œ\nFloatin' through the memories like whatever, you're a waste of time ...ğŸ˜Œ\nYour signals are mixed, you act like a bitch (A bitch)\nYou fit every stereotype, \"Send a pic\"\nI feel so much lighter like a ğŸª¶ with you out my life\nWith you out my life\n\n~\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\nAh, mm\n(ğŸ¶, ğŸ¶, ğŸ¶, ğŸ¶)\nLike a ğŸª¶, like a ğŸª¶, like a ğŸª¶\n\n~\nYou want me? I'm done\nYou miss me? No duh\nWhere I'm at, I'm up where I'm at\nYou want me? I'm done (I'm done)\nYou miss me? No duh (No duh)\nWhere I'm at, I'm up (I'm up) where I'm at\n\n~\nYou want me? I'm done\n(I feel so much lighter like a ğŸª¶ with you off my mind)\nYou miss me? No duh\nWhere I'm at, I'm up where I'm at\n(Like a ğŸª¶, like a ğŸª¶, like a ğŸª¶)\nYou want me? I'm done\n(I feel so much lighter like a ğŸª¶ with you off my mind)\nYou miss me? No duh\nWhere I'm at, I'm up where I'm at\n(Like a ğŸª¶, like a ğŸª¶, like a ğŸª¶, yeah)\n```\n\n\n:::\n:::\n\n\n\n\n## Whatever you're a waste of time\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nany_pattern <- \\(p) paste0(\"(\", p, \")\", collapse = \"|\")\n\nfeather |> \n  dplyr::mutate(\n    line = dplyr::row_number(),\n    match = stringr::str_extract_all(original, any_pattern(rules$pattern))\n  ) |> \n  tidyr::unnest_longer(\"match\") |> \n  dplyr::count(line, match)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 38 Ã— 3\n    line match            n\n   <int> <chr>        <int>\n 1     1 [Intro]          1\n 2     2 Do-do-do         1\n 3     2 do-do-do         3\n 4     3 Do-do            1\n 5     3 do-do-do         3\n 6     6 [Verse 1]        1\n 7    12 [Pre-Chorus]     1\n 8    18 [Chorus]         1\n 9    19 (Ah)             1\n10    19 feather          1\n# â„¹ 28 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}